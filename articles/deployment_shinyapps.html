<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deploying exams to shinyapps.io • examinr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Deploying exams to shinyapps.io">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">examinr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/examinr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Content</li>
    <li>
      <a href="../articles/randomized_exam.html">Randomization</a>
    </li>
    <li>
      <a href="../articles/question_types.html">Question types</a>
    </li>
    <li>
      <a href="../articles/exercises.html">Coding exercises</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../articles/grading.html">Grading</a>
    </li>
    <li>
      <a href="../articles/deployment_shinyapps.html">Deploying to shinyapps.io</a>
    </li>
    <li>
      <a href="../articles/deployment.html">Deploying (general)</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Configuration</li>
    <li>
      <a href="../articles/navigation.html">Section navigation</a>
    </li>
    <li>
      <a href="../articles/config_access.html">Controlling access to exams</a>
    </li>
    <li>
      <a href="../articles/config_storage.html">Storage configuration</a>
    </li>
    <li>
      <a href="../articles/localization.html">Localization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dakep/examinr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Deploying exams to shinyapps.io</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dakep/examinr/blob/main/vignettes/deployment_shinyapps.Rmd" class="external-link"><code>vignettes/deployment_shinyapps.Rmd</code></a></small>
      <div class="hidden name"><code>deployment_shinyapps.Rmd</code></div>

    </div>

    
    
<p>If you don’t have access to your own shiny server or database server,
hosting exams may seem intriguing. A simple alternative to acquiring,
setting up, and managing your own infrastructure is to use cloud-based
hosting providers. This guide showcases how to use <a href="https://www.shinyapps.io" class="external-link">shinyapps.io</a> for hosting the exam
and <a href="https://aws.amazon.com/rds/" class="external-link">AWS RDS</a> for hosting the
database. Of course there are numerous other hosting providers which may
better suite your needs or preferences, and many of the steps outlined
here can be easily translated to these other providers.</p>
<p><strong>Important caveats when using hosting services such as
shinyapps.io:</strong></p>
<ul>
<li>
<strong>Security:</strong> it is not safe to add exercise questions
to exams hosted on shinyapps.io, as there is no way of preventing the
user-code from accessing the exam document file (a learner could see the
solutions). Even more concerning, learners could access the credentials
used for the database connection!</li>
<li>
<strong>Costs:</strong> some of the services used in this guide may
incur costs. <a href="https://www.shinyapps.io" class="external-link">shinyapps.io</a> offers
a free account which is sufficient for trying out exam documents, and
may be enough to administer an exam to a small group of learners. The
RDS service hosted by <a href="https://aws.amazon.com" class="external-link">Amazon AWS</a>
also has a <em>free tier</em> program (for up to 1 year), which gives
you access to a database for testing or few learners. If you need to
provision for exams for a larger number of learners, the free services
may not be sufficient. However, you can easily scale up the database
and/or the shinyapps.io resources without having to redo the setup.
Similarly, you can stop the database during times you don’t need it and
you will not pay anything for running the database. If you are above the
free tier usage limits for storage size, you would continue to pay for
the storage. But it is very unlikely that you would come close to the
free tier limits if you store only data from examinr exams.</li>
</ul>
<p>The following guide explains how to use the free services provided by
shinyapps.io and Amazon AWS and you will need</p>
<ul>
<li>an <a href="https://aws.amazon.com" class="external-link">Amazon AWS</a> account</li>
<li>an account on <a href="https://www.shinyapps.io" class="external-link">shinyapps.io</a> (a
free account is sufficient for now)</li>
<li>
<a href="http://www.pgadmin.org/" class="external-link">pgAdmin 4</a> or the
<code>psql</code> command line utility on your local computer</li>
<li>the RStudio IDE</li>
</ul>
<p>The three steps covered in this guide are</p>
<ol style="list-style-type: decimal">
<li>Setting up a database on AWS RDS.</li>
<li>Preparing the exam document to use the new database.</li>
<li>Publishing the exam to shinyapps.io.</li>
</ol>
<div class="section level2">
<h2 id="step-1-setting-up-a-database-on-aws-rds">Step 1: Setting up a database on AWS RDS<a class="anchor" aria-label="anchor" href="#step-1-setting-up-a-database-on-aws-rds"></a>
</h2>
<p>Log in to the <a href="https://console.aws.amazon.com" class="external-link">Amazon AWS
Management Console</a>. Ensure you are operating in the AWS region your
database should be hosted in (can be selected in the top right corner of
the management console). This is relevant if you have to follow certain
data privacy laws which mandate the location where data needs to be
stored.</p>
<div class="section level3">
<h3 id="step-1-1-configure-the-cluster-network">Step 1.1: Configure the cluster network<a class="anchor" aria-label="anchor" href="#step-1-1-configure-the-cluster-network"></a>
</h3>
<div class="section level4">
<h4 id="step-1-1-1-set-up-a-vpc">Step 1.1.1: Set up a VPC<a class="anchor" aria-label="anchor" href="#step-1-1-1-set-up-a-vpc"></a>
</h4>
<p>Go to the service <em>VPC</em> to configure the “virtual private
cloud” network. This is a “virtual network” in which the database server
will be launched in.</p>
<ol style="list-style-type: decimal">
<li>Click on <em>Create VPC</em>.</li>
<li>Set the name of the VPC to something descriptive, e.g.,
<code>examinr-db</code>.</li>
<li>Use an IPv4 CIDR block of <code>172.31.0.0/16</code>.</li>
<li>Click on <em>Create VPC</em>.</li>
</ol>
<div class="float">
<img src="figures%2Fpublish%2Fcreate_vpc.png" style="width:50.0%" alt="Settings for the new VPC."><div class="figcaption">Settings for the new VPC.</div>
</div>
</div>
<div class="section level4">
<h4 id="step-1-1-2-create-a-security-group">Step 1.1.2: Create a security group<a class="anchor" aria-label="anchor" href="#step-1-1-2-create-a-security-group"></a>
</h4>
<p>Next you need to create a security group which specifies through what
channels someone can access the server inside the VPC and also how the
server inside the VPC may communicate with the outside.</p>
<ol style="list-style-type: decimal">
<li>In the navigation on the left, click on <em>Security
Groups</em>.</li>
<li>Click on <em>Create Security Group</em>.</li>
<li>Set a descriptive name for the security group, e.g.,
<code>examinr-db-sg</code>.</li>
<li>Add a description, e.g.,
<code>Security group for the database cluster storing examinr exam data.</code>.</li>
<li>Select the previously created VPC (<code>examinr-db</code>).</li>
<li>Under <strong>Inbound rules</strong> click on <em>Add rule</em>.
<ol style="list-style-type: decimal">
<li>Under <strong>Type</strong> select <em>PostgreSQL</em>.</li>
<li>Under <strong>Source</strong> select <em>Anywhere</em>. If you don’t
want to restrict network access to your database, you can white-list
only your local computer (by selecting <em>My IP</em>) and the the
shinyapps.io network (see the <a href="https://docs.rstudio.com/shinyapps.io/applications.html#firewalls" class="external-link">official
documentation</a> for a list of IP addresses).</li>
</ol>
</li>
<li>The <strong>Outbound rules</strong> can be left as-is.</li>
<li>Click on <em>Create security group</em>
</li>
</ol>
<div class="float">
<img src="figures%2Fpublish%2Fcreate_sg.png" style="width:100.0%" alt="Settings for the new security group."><div class="figcaption">Settings for the new security group.</div>
</div>
<p>Now you have defined a network which allows inbound traffic only to
the database.</p>
</div>
</div>
<div class="section level3">
<h3 id="step-1-1-create-a-database-instance">Step 1.1: Create a database instance<a class="anchor" aria-label="anchor" href="#step-1-1-create-a-database-instance"></a>
</h3>
<p>Go to the service <em>RDS</em> to create you database instance</p>
<ol style="list-style-type: decimal">
<li>Click on <em>Create database</em>. Ensure again that you are in the
correct region!</li>
<li>Under <strong>Choose a database creation method</strong>, select
<em>Standard create</em>.</li>
<li>Under <strong>Engine options</strong>, select <em>PostgreSQL</em> as
the engine type and leave the selected version.</li>
<li>Under <strong>Templates</strong>, select <em>Free tier</em>.</li>
<li>Under <strong>Settings</strong>, use a descriptive name for the DB
instance identifier, e.g., <code>examinr-db</code>. Leave the master
username as <code>postgres</code> and select <em>Auto generate a
password</em> as this is the most secure option.
<strong>Important:</strong> this is a very, very sensitive password and
hence should be very complex. You will use this password only once and
you can specify a new password in the AWS console if you forget it, so
there is no need to make the password easy to memorize or anything.
Anyone with this password can access all the exam data!</li>
<li>Leave the settings under <strong>DB instance size</strong>,
<strong>Storage</strong>, and <strong>Availability &amp;
durability</strong> as they are. You can increase the instance size and
storage size later when your database becomes a bottleneck for the exam
(e.g., if your exam is used by &gt; 20 learners at a time).</li>
<li>Under <strong>Connectivity</strong>, select the following
<ol style="list-style-type: decimal">
<li>Select the VPC you created in <a href="#step-1.1.1-set-up-a-vpc">Step 1.1.1</a>.</li>
<li>Under Public access, select <em>Yes</em>.</li>
</ol>
</li>
<li>Under <strong>Database authentication</strong>, select <em>Password
authentication</em>.</li>
<li>If you chose to automatically generate the password, the <em>View
credential details</em> button appears on the Database page. To view the
password for the DB instance, click on <em>View credential details</em>.
Take note of the password as you cannot view it again (but you can
change the master password anytime in the AWS console).</li>
</ol>
<div class="float">
<img src="figures%2Fpublish%2Fcreate_db.png" style="width:100.0%" alt="Settings for the new database."><div class="figcaption">Settings for the new database.</div>
</div>
<p>The new database will take a few minutes to be created and
started.</p>
</div>
<div class="section level3">
<h3 id="step-1-2-create-a-database-on-the-db-instance">Step 1.2: Create a database on the DB instance<a class="anchor" aria-label="anchor" href="#step-1-2-create-a-database-on-the-db-instance"></a>
</h3>
<p>Once the new database is launched, click on the DB identifier
<code>examinr-db</code> to get the summary information for the new
database. Locate the endpoint URL:</p>
<div class="float">
<img src="figures%2Fpublish%2Fdb_summary_conn.png" style="width:40.0%" alt="Endpoint URL for the newly created DB instance"><div class="figcaption">Endpoint URL for the newly created DB
instance</div>
</div>
<p>If you use <a href="https://www.pgadmin.org" class="external-link">pgAdmin 4</a>, you need
to use the information from the summary page to set up the connection to
the DB instance. Start pgAdmin 4, click on <em>Object</em> &gt;
<em>Create</em> &gt; <em>Server</em>, and enter the details for the
server connection, as shown in the figure below (replace
<em>DB_instance_endpoint</em> with the endpoint URL of the DB instance)
Click on <em>Save</em>.</p>
<div class="float">
<img src="figures%2Fpublish%2Fpgadmin_conn.png" style="width:67.0%" alt="Add server connection to pgAdmin 4."><div class="figcaption">Add server connection to pgAdmin 4.</div>
</div>
<p>When connected to the DB instance, you need to create a database for
the exam data. In pgAdmin 4, click on <em>Object</em> &gt;
<em>Create</em> &gt; <em>Database</em> and enter <code>examinr</code> as
<em>Database</em> name. Click on <em>Save</em>.</p>
<div class="float">
<img src="figures%2Fpublish%2Fpgadmin_newdb.png" style="width:33.0%" alt="Create a new database on the DB instance."><div class="figcaption">Create a new database on the DB instance.</div>
</div>
<p>If you have the <code>psql</code> command line utilities installed,
you can also run the following command in your shell (replace
<em>DB_instance_endpoint</em> with the endpoint URL of the DB
instance):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">createdb</span> <span class="dt">\</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="at">--host</span><span class="op">=</span>DB_instance_endpoint <span class="dt">\</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">--port</span><span class="op">=</span>5432 <span class="dt">\</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">--username</span><span class="op">=</span>postgres <span class="dt">\</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="at">--encoding</span><span class="op">=</span>UTF8 <span class="dt">\</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  examinr</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-1-3-create-a-database-role">Step 1.3: Create a database role<a class="anchor" aria-label="anchor" href="#step-1-3-create-a-database-role"></a>
</h3>
<p>Once the database is created, you need to create a role, i.e., the DB
user used for connecting to the database from the exam document).</p>
<p>If you use pgAdmin 4, click on <em>Object</em> &gt; <em>Create</em>
&gt; <em>Login/Group Role</em>:</p>
<ul>
<li>Under <em>General</em>, enter the name for the role, e.g.,
<code>examinr</code>.</li>
<li>Under <em>Definition</em>, enter the password for the role.</li>
<li>Under <em>Privileges</em>, set <em>Can login?</em> to <em>Yes</em>
and leave the others as <em>No</em>.</li>
</ul>
<p>Click on <em>Save</em>.</p>
<div class="float">
<img src="figures%2Fpublish%2Fpgadmin_newrole.png" style="width:100.0%" alt="Create a new role for connecting to the database."><div class="figcaption">Create a new role for connecting to the
database.</div>
</div>
<p>If you have the <code>psql</code> command line utilities installed,
you can add the role by starting the <code>psql</code> shell with
(replace <em>DB_instance_endpoint</em> with the endpoint URL of the DB
instance):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">psql</span> <span class="dt">\</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="at">--host</span><span class="op">=</span>DB_instance_endpoint <span class="dt">\</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">--port</span><span class="op">=</span>5432 <span class="dt">\</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="at">--username</span><span class="op">=</span>postgres <span class="dt">\</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="at">--dbname</span><span class="op">=</span>examinr</span></code></pre></div>
<p>This opens a shell where you can enter SQL and <code>psql</code>
commands:</p>
<pre><code>psql (12.1, server 12.4)
SSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)
Type "help" for help.

examinr=&gt;</code></pre>
<p>The role <code>examinr</code> can be created created by running the
following two commands:</p>
<pre><code>CREATE ROLE examinr WITH LOGIN NOSUPERUSER NOCREATEDB NOCREATEROLE;
\password examinr</code></pre>
</div>
<div class="section level3">
<h3 id="step-1-4-create-the-tables">Step 1.4: Create the tables<a class="anchor" aria-label="anchor" href="#step-1-4-create-the-tables"></a>
</h3>
<p>Open a query tool in pgAdmin 4 for the <code>examinr</code> database
by clicking on the <em>examinr</em> database and then using right-click
on the database to start the query tool:</p>
<div class="float">
<img src="figures%2Fpublish%2Fpgadmin_query.png" style="width:30.0%" alt="Start the query tool on the examinr database."><div class="figcaption">Start the query tool on the <em>examinr</em>
database.</div>
</div>
<p>If using the <code>psql</code> command line utilities, connect to the
<code>examinr</code> database with:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">psql</span> <span class="dt">\</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="at">--host</span><span class="op">=</span>DB_instance_endpoint <span class="dt">\</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="at">--port</span><span class="op">=</span>5432 <span class="dt">\</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="at">--username</span><span class="op">=</span>postgres <span class="dt">\</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="at">--dbname</span><span class="op">=</span>examinr</span></code></pre></div>
<p>Either in the query tool (if using pgAdmin 4) or in the
<code>psql</code> shell, run the following SQL commands:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> attempts (</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  attempt_id   uuid              <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  user_id      <span class="dt">character</span> <span class="dt">varying</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  exam_id      <span class="dt">character</span> <span class="dt">varying</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  exam_version <span class="dt">character</span> <span class="dt">varying</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  started_at   <span class="dt">double</span> <span class="dt">precision</span>  <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  seed         <span class="dt">integer</span>           <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  user_obj     text              <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  finished_at  <span class="dt">double</span> <span class="dt">precision</span>,</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  points       text</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>);</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> attempts_index <span class="kw">ON</span> attempts (user_id, exam_id, exam_version);</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> section_data (</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>  <span class="kw">id</span>           serial            <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>  attempt_id   uuid              <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">REFERENCES</span> attempts (attempt_id)</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>                                          <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span> <span class="kw">ON</span> <span class="kw">UPDATE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>  section      <span class="dt">character</span> <span class="dt">varying</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>  saved_at     <span class="dt">double</span> <span class="dt">precision</span>  <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>  section_data text</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>);</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> section_data_index <span class="kw">ON</span> section_data (attempt_id, section);</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">CONNECT</span> <span class="kw">ON</span> <span class="kw">DATABASE</span> examinr <span class="kw">TO</span> examinr;</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">SELECT</span>, <span class="kw">INSERT</span>, <span class="kw">UPDATE</span> <span class="kw">ON</span> attempts <span class="kw">TO</span> examinr;</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">SELECT</span>, <span class="kw">INSERT</span>, <span class="kw">DELETE</span> <span class="kw">ON</span> section_data <span class="kw">TO</span> examinr;</span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">USAGE</span> <span class="kw">ON</span> section_data_id_seq <span class="kw">TO</span> examinr;</span></code></pre></div>
<p>Now your database is all set up and ready to be used from the exam
document.</p>
</div>
</div>
<div class="section level2">
<h2 id="step-2-using-the-new-database-in-an-exam">Step 2: Using the new database in an exam<a class="anchor" aria-label="anchor" href="#step-2-using-the-new-database-in-an-exam"></a>
</h2>
<p>You can now create an exam which uses the newly created database. In
RStudio, click on <em>File</em> &gt; <em>New File</em> &gt; <em>R
Markdown…</em>. Select <em>From Template</em> and select the
<em>Exam</em> template. Enter the name of the exam document and where to
save the exam.</p>
<p>You would go about creating the exam as usual, but you also need to
give the exam document the connection credentials (i.e., the name and
password for the role you created before). The easiest way is to create
the file <em>.Renviron</em> in the directory of the exam document. The
contents of this file would be</p>
<pre><code><span><span class="va">PGUSER</span><span class="op">=</span><span class="st">'examinr'</span></span>
<span><span class="va">PGPASSWORD</span><span class="op">=</span><span class="st">'password_for_database_user_examinr'</span></span></code></pre>
<p>You need to replace <em>password_for_database_user_examinr</em> with
the actual password you entered when creating the database role
<code>examinr</code>. For more control, you could use the config
package.</p>
<p><strong>Important:</strong> The file is readable by the user-code
from exercises and hence would expose your database credentials.
Currently, it is not safe to add exercise questions to exams hosted on
shinyapps.io, as there is no way of preventing the user-code from
accessing the credentials file.</p>
<p>Now you are ready to set up the connection with the database in the
exam document. The connection is established in a code chunk with
<em>server-start</em> context, as in the following sample exam.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Exam Using AWS RDS"</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="an">lang:</span><span class="co"> en-US</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">  examinr::exam_document:</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">    id: exam-using-aws-rds</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">    version: 0.1</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">    progressive: no</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">    feedback: immediately</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="an">runtime:</span><span class="co"> shiny_prerendered</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="in"># Load the package</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="in">library(examinr)</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(echo = FALSE)</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="in">```{r, context="server-start"}</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="in">library(pool)</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="in">library(RPostgres)</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="in"># Establish a pool of connections to the database.</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="in"># User-name and password are taken from environment variables</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a><span class="in"># PGUSER and PGPASSWORD, respectively.</span></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="in">db_con &lt;- dbPool(drv = Postgres(),</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="in">                 dbname = "examinr",</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="in">                 host = "db-examinr-testing.cwdxbpewlsih.ca-central-1.rds.amazonaws.com",</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a><span class="in">                 timezone = "UTC",</span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="in">                 minSize = 1, maxSize = 1)</span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="in"># Close the DB connection when shiny stops.</span></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a><span class="in">shiny::onStop(function () { poolClose(db_con) })</span></span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a><span class="in"># Instruct the `future` package to run the user-supplied code in a separate R process.</span></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a><span class="in">library(future)</span></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a><span class="in">plan(cluster, workers = 1)</span></span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a><span class="in"># Use the new database as storage provider.</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a><span class="in">exam_config(storage_provider = dbi_storage_provider(db_con, 'attempts', 'section_data')</span></span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a>This simple exam demonstrates how to use a database instance hosted on AWS RDS</span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a>for storing exam data.</span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a>It is important to keep the DB instance secured and the master password secret.</span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a></span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a><span class="fu"># Questions</span></span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a><span class="in">```{r q-1}</span></span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a><span class="in">mc_question(</span></span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a><span class="in">  title = "Where is the exam data stored?",</span></span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a><span class="in">  checkbox = FALSE,</span></span>
<span id="cb8-55"><a href="#cb8-55" tabindex="-1"></a><span class="in">  answer("On an Amazon AWS RDS database instance.", correct = TRUE),</span></span>
<span id="cb8-56"><a href="#cb8-56" tabindex="-1"></a><span class="in">  answer("In a SQLite database file."),</span></span>
<span id="cb8-57"><a href="#cb8-57" tabindex="-1"></a><span class="in">  answer("In a SQLite database in memory."),</span></span>
<span id="cb8-58"><a href="#cb8-58" tabindex="-1"></a><span class="in">  answer("On a database somewhere on the internet."),</span></span>
<span id="cb8-59"><a href="#cb8-59" tabindex="-1"></a><span class="in">  answer("The data is not saved anywhere.")</span></span>
<span id="cb8-60"><a href="#cb8-60" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb8-61"><a href="#cb8-61" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-62"><a href="#cb8-62" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" tabindex="-1"></a></span>
<span id="cb8-64"><a href="#cb8-64" tabindex="-1"></a><span class="in">```{r q-2}</span></span>
<span id="cb8-65"><a href="#cb8-65" tabindex="-1"></a><span class="in">mc_question(</span></span>
<span id="cb8-66"><a href="#cb8-66" tabindex="-1"></a><span class="in">  title = "How to avoid privacy and security issues?",</span></span>
<span id="cb8-67"><a href="#cb8-67" tabindex="-1"></a><span class="in">  answer("Ensure the DB instance is running in the correct AWS region.", correct = TRUE),</span></span>
<span id="cb8-68"><a href="#cb8-68" tabindex="-1"></a><span class="in">  answer("Use a complex master password for the DB instance and not share it.", correct = TRUE),</span></span>
<span id="cb8-69"><a href="#cb8-69" tabindex="-1"></a><span class="in">  answer("Do **not** add exercise question as they may expose the database credentials", correct = TRUE),</span></span>
<span id="cb8-70"><a href="#cb8-70" tabindex="-1"></a><span class="in">  answer("Use a random endpoint URL for the DB instance."),</span></span>
<span id="cb8-71"><a href="#cb8-71" tabindex="-1"></a><span class="in">  answer("Do not tell anybody that the database is hosted on AWS RDS."),</span></span>
<span id="cb8-72"><a href="#cb8-72" tabindex="-1"></a><span class="in">  answer("Amazon AWS guarantees security of the data and that privacy issues are avoided.")</span></span>
<span id="cb8-73"><a href="#cb8-73" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb8-74"><a href="#cb8-74" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-3-publishing-the-exam-to-shinyapps-io">Step 3: Publishing the exam to shinyapps.io<a class="anchor" aria-label="anchor" href="#step-3-publishing-the-exam-to-shinyapps-io"></a>
</h2>
<p>First you need to install the latest version of the rsconnect package
by running the following R command:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'rsconnect'</span><span class="op">)</span></span></code></pre></div>
<p>You need to authorize RStudio to publish documents to your
shinyapps.io account by following the instructions in the <a href="https://shiny.rstudio.com/articles/shinyapps.html" class="external-link">shiny
documentation</a>.</p>
<p>Once you completed the exam document, click on <em>Publish
Document…</em> in the top right corner of the RStudio IDE. On the left
the <em>.Rmd</em> file, the database credentials
(<em>www/pgauth.yaml</em>) and any other resource file the exam needs.
On the right, select your shinyapps.io account and set the name of the
exam and click <em>Publish</em>.</p>
</div>
<div class="section level2">
<h2 id="scaling-updown-to-meet-your-demand">Scaling up/down to meet your demand<a class="anchor" aria-label="anchor" href="#scaling-updown-to-meet-your-demand"></a>
</h2>
<p>The database instance on AWS RDS and the shiny server on shinyapps.io
can be scaled up if your exam needs to be accessed by a larger number of
learners. You can also monitor the load of the DB instance and your
shiny app to decide if more resources are needed for your number of
learners. Note, however, that scaling the shiny server or DB instance
up/down will take them offline for several minutes, making the exam
inaccessible during this time. If you are not sure if your number of
learners will require more resources than available for free, it is
suggested to administer a low-stakes exam to your learners and monitor
the load of the DB instance and shiny server. If you notice the any of
the services buckle under the load, you have to consider scaling up the
resources.</p>
<p>In most use-cases it would also make sense to scale up resources for
the duration of the actual exam (when many learners access the exam at
the same time) and scale back down after the exam. Grading and accessing
feedback are typically less demanding as the load is spread more over
time. In many cases, a large number of learners submits the exam at the
same time, leading to a very high load on the database and shiny server
for a brief moment. Being able to handle these substantial spikes is
important for a smooth exam experience. After this rush, however, demand
will be minimal.</p>
<div class="section level3">
<h3 id="scaling-the-db-instance">Scaling the DB instance<a class="anchor" aria-label="anchor" href="#scaling-the-db-instance"></a>
</h3>
<p>AWS RDS offers a wide range of instance sizes. The free tier applies
only to the smallest instance (currently <code>db.t3.micro</code>). For
most exams, “burstable” instance classes are sufficient and much cheaper
than standard or optimized instance classes.</p>
<p>You can also stop the DB instance during times where no exam needs to
be accessible. You will not be billed for computing time while the
instance is stopped, but the charges for storage will continue. The size
of the exam data, however, is small and would not incur high costs.</p>
</div>
<div class="section level3">
<h3 id="scaling-the-shiny-server">Scaling the shiny server<a class="anchor" aria-label="anchor" href="#scaling-the-shiny-server"></a>
</h3>
<p>Your shinyapps.io account gives you the option to purchase monthly or
yearly plans. You would only get more resources when subscribing to at
least the <em>Basic</em> plan. These plans allow you to use more than 1
instance and more than 1 worker process per instance for your exam.</p>
<p>To increase the number of instances/worker processes for your exam,
go to your exam shiny app on shinyapps.io and click on
<em>Settings</em>. Here you have three main knobs to increase the number
of learners you can serve simultaneously:</p>
<ul>
<li>Under <em>General</em>, you can select a larger instance size; the
more memory the more learners you can serve.</li>
<li>Under <em>Advanced</em>, you can set:
<ul>
<li>The start count under instance settings determines how many
instances are started at the beginning. If you expect all your learners
to access the exam at the same time, this should be set to the maximum
value (depends on your plan). Note that a larger number of instances
depletes your allocated number of active hours more quickly.</li>
<li>The maximum number of worker processes (up to 10). All these
processes run in the same instance, so 10 processes may even slow down
the server. It is suggested to use 3 — 6 processes.</li>
</ul>
</li>
</ul>
<p>You should ensure that your plan allows you to have enough instances
number of worker processes such that your exam can serve the expected
number of learners:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Number of learners</mtext><mo>&gt;</mo><mtext mathvariant="normal">Max Worker Processes</mtext><mo>×</mo><mtext mathvariant="normal">Maximum Instances Limit</mtext><mo>×</mo><mtext mathvariant="normal">Max Connections</mtext></mrow><annotation encoding="application/x-tex">
\text{Number of learners} &gt; \text{Max Worker Processes} \times \text{Maximum Instances Limit} \times \text{Max Connections}
</annotation></semantics></math></p>
<p>The <a href="https://docs.rstudio.com/shinyapps.io/applications.html" class="external-link">shinyapps.io
user guide</a> has comprehensive information on setting and tuning
application performance.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Kepplinger.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
