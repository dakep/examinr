<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deploying exams to shinyapps.io • examinr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Deploying exams to shinyapps.io">
<meta property="og:description" content="examinr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">examinr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/examinr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Content</li>
    <li>
      <a href="../articles/randomized_exam.html">Randomization</a>
    </li>
    <li>
      <a href="../articles/question_types.html">Question types</a>
    </li>
    <li>
      <a href="../articles/exercises.html">Coding exercises</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/grading.html">Grading</a>
    </li>
    <li>
      <a href="../articles/deployment_shinyapps.html">Deploying to shinyapps.io</a>
    </li>
    <li>
      <a href="../articles/deployment.html">Deploying (general)</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Configuration</li>
    <li>
      <a href="../articles/navigation.html">Section navigation</a>
    </li>
    <li>
      <a href="../articles/config_access.html">Controlling access to exams</a>
    </li>
    <li>
      <a href="../articles/config_storage.html">Storage configuration</a>
    </li>
    <li>
      <a href="../articles/localization.html">Localization</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dakep/examinr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Deploying exams to shinyapps.io</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dakep/examinr/blob/master/vignettes/deployment_shinyapps.Rmd"><code>vignettes/deployment_shinyapps.Rmd</code></a></small>
      <div class="hidden name"><code>deployment_shinyapps.Rmd</code></div>

    </div>

    
    
<p>If you don’t have access to your own shiny server or database server, hosting exams may seem intriguing. A simple alternative to acquiring, setting up, and managing your own infrastructure is to use cloud-based hosting providers. This guide showcases how to use <a href="https://www.shinyapps.io">shinyapps.io</a> for hosting the exam and <a href="https://aws.amazon.com/rds/">AWS RDS</a> for hosting the database. Of course there are numerous other hosting providers which may better suite your needs or preferences, and many of the steps outlined here can be easily translated to these other providers.</p>
<p><strong>Important caveats when using hosting services such as shinyapps.io:</strong></p>
<ul>
<li>
<strong>Security:</strong> it is not safe to add exercise questions to exams hosted on shinyapps.io, as there is no way of preventing the user-code from accessing the exam document file (a learner could see the solutions). Even more concerning, learners could access the credentials used for the database connection!</li>
<li>
<strong>Costs:</strong> some of the services used in this guide may incur costs. <a href="https://www.shinyapps.io">shinyapps.io</a> offers a free account which is sufficient for trying out exam documents, and may be enough to administer an exam to a small group of learners. The RDS service hosted by <a href="https://aws.amazon.com">Amazon AWS</a> also has a <em>free tier</em> program (for up to 1 year), which gives you access to a database for testing or few learners. If you need to provision for exams for a larger number of learners, the free services may not be sufficient. However, you can easily scale up the database and/or the shinyapps.io resources without having to redo the setup. Similarly, you can stop the database during times you don’t need it and you will not pay anything for running the database. If you are above the free tier usage limits for storage size, you would continue to pay for the storage. But it is very unlikely that you would come close to the free tier limits if you store only data from examinr exams.</li>
</ul>
<p>The following guide explains how to use the free services provided by shinyapps.io and Amazon AWS and you will need</p>
<ul>
<li>an <a href="https://aws.amazon.com">Amazon AWS</a> account</li>
<li>an account on <a href="https://www.shinyapps.io">shinyapps.io</a> (a free account is sufficient for now)</li>
<li>
<a href="http://www.pgadmin.org/">pgAdmin 4</a> or the <code>psql</code> command line utility on your local computer</li>
<li>the RStudio IDE</li>
</ul>
<p>The three steps covered in this guide are</p>
<ol style="list-style-type: decimal">
<li>Setting up a database on AWS RDS.</li>
<li>Preparing the exam document to use the new database.</li>
<li>Publishing the exam to shinyapps.io.</li>
</ol>
<div id="step-1-setting-up-a-database-on-aws-rds" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1-setting-up-a-database-on-aws-rds" class="anchor"></a>Step 1: Setting up a database on AWS RDS</h2>
<p>Log in to the <a href="https://console.aws.amazon.com">Amazon AWS Management Console</a>. Ensure you are operating in the AWS region your database should be hosted in (can be selected in the top right corner of the management console). This is relevant if you have to follow certain data privacy laws which mandate the location where data needs to be stored.</p>
<div id="step-1-1-configure-the-cluster-network" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1-1-configure-the-cluster-network" class="anchor"></a>Step 1.1: Configure the cluster network</h3>
<div id="step-1-1-1-set-up-a-vpc" class="section level4">
<h4 class="hasAnchor">
<a href="#step-1-1-1-set-up-a-vpc" class="anchor"></a>Step 1.1.1: Set up a VPC</h4>
<p>Go to the service <em>VPC</em> to configure the “virtual private cloud” network. This is a “virtual network” in which the database server will be launched in.</p>
<ol style="list-style-type: decimal">
<li>Click on <em>Create VPC</em>.</li>
<li>Set the name of the VPC to something descriptive, e.g., <code>examinr-db</code>.</li>
<li>Use an IPv4 CIDR block of <code>172.31.0.0/16</code>.</li>
<li>Click on <em>Create VPC</em>.</li>
</ol>
<div class="figure">
<img src="figures/publish/create_vpc.png" alt="Settings for the new VPC." style="width:50.0%"><p class="caption">Settings for the new VPC.</p>
</div>
</div>
<div id="step-1-1-2-create-a-security-group" class="section level4">
<h4 class="hasAnchor">
<a href="#step-1-1-2-create-a-security-group" class="anchor"></a>Step 1.1.2: Create a security group</h4>
<p>Next you need to create a security group which specifies through what channels someone can access the server inside the VPC and also how the server inside the VPC may communicate with the outside.</p>
<ol style="list-style-type: decimal">
<li>In the navigation on the left, click on <em>Security Groups</em>.</li>
<li>Click on <em>Create Security Group</em>.</li>
<li>Set a descriptive name for the security group, e.g., <code>examinr-db-sg</code>.</li>
<li>Add a description, e.g., <code>Security group for the database cluster storing examinr exam data.</code>.</li>
<li>Select the previously created VPC (<code>examinr-db</code>).</li>
<li>Under <strong>Inbound rules</strong> click on <em>Add rule</em>.
<ol style="list-style-type: decimal">
<li>Under <strong>Type</strong> select <em>PostgreSQL</em>.</li>
<li>Under <strong>Source</strong> select <em>Anywhere</em>. If you don’t want to restrict network access to your database, you can white-list only your local computer (by selecting <em>My IP</em>) and the the shinyapps.io network (see the <a href="https://docs.rstudio.com/shinyapps.io/applications.html#firewalls">official documentation</a> for a list of IP addresses).</li>
</ol>
</li>
<li>The <strong>Outbound rules</strong> can be left as-is.</li>
<li>Click on <em>Create security group</em>
</li>
</ol>
<div class="figure">
<img src="figures/publish/create_sg.png" alt="Settings for the new security group." style="width:100.0%"><p class="caption">Settings for the new security group.</p>
</div>
<p>Now you have defined a network which allows inbound traffic only to the database.</p>
</div>
</div>
<div id="step-1-1-create-a-database-instance" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1-1-create-a-database-instance" class="anchor"></a>Step 1.1: Create a database instance</h3>
<p>Go to the service <em>RDS</em> to create you database instance</p>
<ol style="list-style-type: decimal">
<li>Click on <em>Create database</em>. Ensure again that you are in the correct region!</li>
<li>Under <strong>Choose a database creation method</strong>, select <em>Standard create</em>.</li>
<li>Under <strong>Engine options</strong>, select <em>PostgreSQL</em> as the engine type and leave the selected version.</li>
<li>Under <strong>Templates</strong>, select <em>Free tier</em>.</li>
<li>Under <strong>Settings</strong>, use a descriptive name for the DB instance identifier, e.g., <code>examinr-db</code>. Leave the master username as <code>postgres</code> and select <em>Auto generate a password</em> as this is the most secure option. <strong>Important:</strong> this is a very, very sensitive password and hence should be very complex. You will use this password only once and you can specify a new password in the AWS console if you forget it, so there is no need to make the password easy to memorize or anything. Anyone with this password can access all the exam data!</li>
<li>Leave the settings under <strong>DB instance size</strong>, <strong>Storage</strong>, and <strong>Availability &amp; durability</strong> as they are. You can increase the instance size and storage size later when your database becomes a bottleneck for the exam (e.g., if your exam is used by &gt; 20 learners at a time).</li>
<li>Under <strong>Connectivity</strong>, select the following
<ol style="list-style-type: decimal">
<li>Select the VPC you created in <a href="#step-1.1.1-set-up-a-vpc">Step 1.1.1</a>.</li>
<li>Under Public access, select <em>Yes</em>.</li>
</ol>
</li>
<li>Under <strong>Database authentication</strong>, select <em>Password authentication</em>.</li>
<li>If you chose to automatically generate the password, the <em>View credential details</em> button appears on the Database page. To view the password for the DB instance, click on <em>View credential details</em>. Take note of the password as you cannot view it again (but you can change the master password anytime in the AWS console).</li>
</ol>
<div class="figure">
<img src="figures/publish/create_db.png" alt="Settings for the new database." style="width:100.0%"><p class="caption">Settings for the new database.</p>
</div>
<p>The new database will take a few minutes to be created and started.</p>
</div>
<div id="step-1-2-create-a-database-on-the-db-instance" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1-2-create-a-database-on-the-db-instance" class="anchor"></a>Step 1.2: Create a database on the DB instance</h3>
<p>Once the new database is launched, click on the DB identifier <code>examinr-db</code> to get the summary information for the new database. Locate the endpoint URL:</p>
<div class="figure">
<img src="figures/publish/db_summary_conn.png" alt="Endpoint URL for the newly created DB instance" style="width:40.0%"><p class="caption">Endpoint URL for the newly created DB instance</p>
</div>
<p>If you use <a href="https://www.pgadmin.org">pgAdmin 4</a>, you need to use the information from the summary page to set up the connection to the DB instance. Start pgAdmin 4, click on <em>Object</em> &gt; <em>Create</em> &gt; <em>Server</em>, and enter the details for the server connection, as shown in the figure below (replace <em>DB_instance_endpoint</em> with the endpoint URL of the DB instance) Click on <em>Save</em>.</p>
<div class="figure">
<img src="figures/publish/pgadmin_conn.png" alt="Add server connection to pgAdmin 4." style="width:67.0%"><p class="caption">Add server connection to pgAdmin 4.</p>
</div>
<p>When connected to the DB instance, you need to create a database for the exam data. In pgAdmin 4, click on <em>Object</em> &gt; <em>Create</em> &gt; <em>Database</em> and enter <code>examinr</code> as <em>Database</em> name. Click on <em>Save</em>.</p>
<div class="figure">
<img src="figures/publish/pgadmin_newdb.png" alt="Create a new database on the DB instance." style="width:33.0%"><p class="caption">Create a new database on the DB instance.</p>
</div>
<p>If you have the <code>psql</code> command line utilities installed, you can also run the following command in your shell (replace <em>DB_instance_endpoint</em> with the endpoint URL of the DB instance):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ex">createdb</span> \</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  --host=DB_instance_endpoint \</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  --port=5432 \</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  --username=postgres \</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  --encoding=UTF8 \</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  examinr</a></code></pre></div>
</div>
<div id="step-1-3-create-a-database-role" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1-3-create-a-database-role" class="anchor"></a>Step 1.3: Create a database role</h3>
<p>Once the database is created, you need to create a role, i.e., the DB user used for connecting to the database from the exam document).</p>
<p>If you use pgAdmin 4, click on <em>Object</em> &gt; <em>Create</em> &gt; <em>Login/Group Role</em>:</p>
<ul>
<li>Under <em>General</em>, enter the name for the role, e.g., <code>examinr</code>.</li>
<li>Under <em>Definition</em>, enter the password for the role.</li>
<li>Under <em>Privileges</em>, set <em>Can login?</em> to <em>Yes</em> and leave the others as <em>No</em>.</li>
</ul>
<p>Click on <em>Save</em>.</p>
<div class="figure">
<img src="figures/publish/pgadmin_newrole.png" alt="Create a new role for connecting to the database." style="width:100.0%"><p class="caption">Create a new role for connecting to the database.</p>
</div>
<p>If you have the <code>psql</code> command line utilities installed, you can add the role by starting the <code>psql</code> shell with (replace <em>DB_instance_endpoint</em> with the endpoint URL of the DB instance):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="ex">psql</span> \</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  --host=DB_instance_endpoint \</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  --port=5432 \</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  --username=postgres \</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  --dbname=examinr</a></code></pre></div>
<p>This opens a shell where you can enter SQL and <code>psql</code> commands:</p>
<pre><code>psql (12.1, server 12.4)
SSL connection (protocol: TLSv1.2, cipher: ECDHE-RSA-AES256-GCM-SHA384, bits: 256, compression: off)
Type "help" for help.

examinr=&gt;</code></pre>
<p>The role <code>examinr</code> can be created created by running the following two commands:</p>
<pre><code>CREATE ROLE examinr WITH LOGIN NOSUPERUSER NOCREATEDB NOCREATEROLE;
\password examinr</code></pre>
</div>
<div id="step-1-4-create-the-tables" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1-4-create-the-tables" class="anchor"></a>Step 1.4: Create the tables</h3>
<p>Open a query tool in pgAdmin 4 for the <code>examinr</code> database by clicking on the <em>examinr</em> database and then using right-click on the database to start the query tool:</p>
<div class="figure">
<img src="figures/publish/pgadmin_query.png" alt="Start the query tool on the examinr database." style="width:30.0%"><p class="caption">Start the query tool on the <em>examinr</em> database.</p>
</div>
<p>If using the <code>psql</code> command line utilities, connect to the <code>examinr</code> database with:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="ex">psql</span> \</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  --host=DB_instance_endpoint \</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  --port=5432 \</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  --username=postgres \</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  --dbname=examinr</a></code></pre></div>
<p>Either in the query tool (if using pgAdmin 4) or in the <code>psql</code> shell, run the following SQL commands:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> attempts (</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  attempt_id   uuid              <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  user_id      <span class="dt">character</span> <span class="dt">varying</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  exam_id      <span class="dt">character</span> <span class="dt">varying</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  exam_version <span class="dt">character</span> <span class="dt">varying</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  started_at   <span class="dt">double</span> <span class="dt">precision</span>  <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  seed         <span class="dt">integer</span>           <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">  user_obj     text              <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">  finished_at  <span class="dt">double</span> <span class="dt">precision</span>,</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">  points       text</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">);</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="kw">CREATE</span> <span class="kw">INDEX</span> attempts_index <span class="kw">ON</span> attempts (user_id, exam_id, exam_version);</a>
<a class="sourceLine" id="cb6-14" data-line-number="14"></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="kw">CREATE</span> <span class="kw">TABLE</span> section_data (</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">  <span class="kw">id</span>           serial            <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">  attempt_id   uuid              <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">REFERENCES</span> attempts (attempt_id)</a>
<a class="sourceLine" id="cb6-18" data-line-number="18">                                          <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span> <span class="kw">ON</span> <span class="kw">UPDATE</span> <span class="kw">CASCADE</span>,</a>
<a class="sourceLine" id="cb6-19" data-line-number="19">  section      <span class="dt">character</span> <span class="dt">varying</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb6-20" data-line-number="20">  saved_at     <span class="dt">double</span> <span class="dt">precision</span>  <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb6-21" data-line-number="21">  section_data text</a>
<a class="sourceLine" id="cb6-22" data-line-number="22">);</a>
<a class="sourceLine" id="cb6-23" data-line-number="23"></a>
<a class="sourceLine" id="cb6-24" data-line-number="24"><span class="kw">CREATE</span> <span class="kw">INDEX</span> section_data_index <span class="kw">ON</span> section_data (attempt_id, section);</a>
<a class="sourceLine" id="cb6-25" data-line-number="25"></a>
<a class="sourceLine" id="cb6-26" data-line-number="26"><span class="kw">GRANT</span> <span class="kw">CONNECT</span> <span class="kw">ON</span> <span class="kw">DATABASE</span> examinr <span class="kw">TO</span> examinr;</a>
<a class="sourceLine" id="cb6-27" data-line-number="27"><span class="kw">GRANT</span> <span class="kw">SELECT</span>, <span class="kw">INSERT</span>, <span class="kw">UPDATE</span> <span class="kw">ON</span> attempts <span class="kw">TO</span> examinr;</a>
<a class="sourceLine" id="cb6-28" data-line-number="28"><span class="kw">GRANT</span> <span class="kw">SELECT</span>, <span class="kw">INSERT</span>, <span class="kw">DELETE</span> <span class="kw">ON</span> section_data <span class="kw">TO</span> examinr;</a>
<a class="sourceLine" id="cb6-29" data-line-number="29"><span class="kw">GRANT</span> <span class="kw">USAGE</span> <span class="kw">ON</span> section_data_id_seq <span class="kw">TO</span> examinr;</a></code></pre></div>
<p>Now your database is all set up and ready to be used from the exam document.</p>
</div>
</div>
<div id="step-2-using-the-new-database-in-an-exam" class="section level2">
<h2 class="hasAnchor">
<a href="#step-2-using-the-new-database-in-an-exam" class="anchor"></a>Step 2: Using the new database in an exam</h2>
<p>You can now create an exam which uses the newly created database. In RStudio, click on <em>File</em> &gt; <em>New File</em> &gt; <em>R Markdown…</em>. Select <em>From Template</em> and select the <em>Exam</em> template. Enter the name of the exam document and where to save the exam.</p>
<p>You would go about creating the exam as usual, but you also need to give the exam document the connection credentials (i.e., the name and password for the role you created before). The easiest way is to create the file <em>.Renviron</em> in the directory of the exam document. The contents of this file would be</p>
<pre><code>PGUSER='examinr'
PGPASSWORD='password_for_database_user_examinr'</code></pre>
<p>You need to replace <em>password_for_database_user_examinr</em> with the actual password you entered when creating the database role <code>examinr</code>. For more control, you could use the config package.</p>
<p><strong>Important:</strong> The file is readable by the user-code from exercises and hence would expose your database credentials. Currently, it is not safe to add exercise questions to exams hosted on shinyapps.io, as there is no way of preventing the user-code from accessing the credentials file.</p>
<p>Now you are ready to set up the connection with the database in the exam document. The connection is established in a code chunk with <em>server-start</em> context, as in the following sample exam.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode md"><code class="sourceCode markdown"><a class="sourceLine" id="cb8-1" data-line-number="1">---</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">title: "Exam Using AWS RDS"</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">lang: en-US</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">output:</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  examinr::exam_document:</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="bn">    id: exam-using-aws-rds</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="bn">    version: 0.1</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="bn">    progressive: no</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="bn">    feedback: immediately</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">runtime: shiny_prerendered</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">---</a>
<a class="sourceLine" id="cb8-12" data-line-number="12"></a>
<a class="sourceLine" id="cb8-13" data-line-number="13">```{r setup, include=FALSE}</a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="fu"># Load the package</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15">library(examinr)</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">knitr::opts_chunk$set(echo = FALSE)</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">```</a>
<a class="sourceLine" id="cb8-18" data-line-number="18"></a>
<a class="sourceLine" id="cb8-19" data-line-number="19">```{r, context="server-start"}</a>
<a class="sourceLine" id="cb8-20" data-line-number="20">library(pool)</a>
<a class="sourceLine" id="cb8-21" data-line-number="21">library(RPostgres)</a>
<a class="sourceLine" id="cb8-22" data-line-number="22"></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="fu"># Establish a pool of connections to the database.</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="fu"># User-name and password are taken from environment variables</span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25"><span class="fu"># PGUSER and PGPASSWORD, respectively.</span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26">db_con &lt;- dbPool(drv = Postgres(),</a>
<a class="sourceLine" id="cb8-27" data-line-number="27"><span class="bn">                 dbname = "examinr",</span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"><span class="bn">                 host = "db-examinr-testing.cwdxbpewlsih.ca-central-1.rds.amazonaws.com",</span></a>
<a class="sourceLine" id="cb8-29" data-line-number="29"><span class="bn">                 timezone = "UTC",</span></a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="bn">                 minSize = 1, maxSize = 1)</span></a>
<a class="sourceLine" id="cb8-31" data-line-number="31"></a>
<a class="sourceLine" id="cb8-32" data-line-number="32"><span class="fu"># Close the DB connection when shiny stops.</span></a>
<a class="sourceLine" id="cb8-33" data-line-number="33">shiny::onStop(function () { poolClose(db_con) })</a>
<a class="sourceLine" id="cb8-34" data-line-number="34"></a>
<a class="sourceLine" id="cb8-35" data-line-number="35"><span class="fu"># Instruct the `future` package to run the user-supplied code in a separate R process.</span></a>
<a class="sourceLine" id="cb8-36" data-line-number="36">library(future)</a>
<a class="sourceLine" id="cb8-37" data-line-number="37">plan(cluster, workers = 1)</a>
<a class="sourceLine" id="cb8-38" data-line-number="38"></a>
<a class="sourceLine" id="cb8-39" data-line-number="39"><span class="fu"># Use the new database as storage provider.</span></a>
<a class="sourceLine" id="cb8-40" data-line-number="40">exam_config(storage_provider = dbi_storage_provider(db_con, 'attempts', 'section_data')</a>
<a class="sourceLine" id="cb8-41" data-line-number="41">```</a>
<a class="sourceLine" id="cb8-42" data-line-number="42"></a>
<a class="sourceLine" id="cb8-43" data-line-number="43"><span class="fu"># Introduction</span></a>
<a class="sourceLine" id="cb8-44" data-line-number="44"></a>
<a class="sourceLine" id="cb8-45" data-line-number="45">This simple exam demonstrates how to use a database instance hosted on AWS RDS</a>
<a class="sourceLine" id="cb8-46" data-line-number="46">for storing exam data.</a>
<a class="sourceLine" id="cb8-47" data-line-number="47">It is important to keep the DB instance secured and the master password secret.</a>
<a class="sourceLine" id="cb8-48" data-line-number="48"></a>
<a class="sourceLine" id="cb8-49" data-line-number="49"><span class="fu"># Questions</span></a>
<a class="sourceLine" id="cb8-50" data-line-number="50"></a>
<a class="sourceLine" id="cb8-51" data-line-number="51">```{r q-1}</a>
<a class="sourceLine" id="cb8-52" data-line-number="52">mc_question(</a>
<a class="sourceLine" id="cb8-53" data-line-number="53">  title = "Where is the exam data stored?",</a>
<a class="sourceLine" id="cb8-54" data-line-number="54">  checkbox = FALSE,</a>
<a class="sourceLine" id="cb8-55" data-line-number="55">  answer("On an Amazon AWS RDS database instance.", correct = TRUE),</a>
<a class="sourceLine" id="cb8-56" data-line-number="56">  answer("In a SQLite database file."),</a>
<a class="sourceLine" id="cb8-57" data-line-number="57">  answer("In a SQLite database in memory."),</a>
<a class="sourceLine" id="cb8-58" data-line-number="58">  answer("On a database somewhere on the internet."),</a>
<a class="sourceLine" id="cb8-59" data-line-number="59">  answer("The data is not saved anywhere.")</a>
<a class="sourceLine" id="cb8-60" data-line-number="60">)</a>
<a class="sourceLine" id="cb8-61" data-line-number="61">```</a>
<a class="sourceLine" id="cb8-62" data-line-number="62"></a>
<a class="sourceLine" id="cb8-63" data-line-number="63"></a>
<a class="sourceLine" id="cb8-64" data-line-number="64">```{r q-2}</a>
<a class="sourceLine" id="cb8-65" data-line-number="65">mc_question(</a>
<a class="sourceLine" id="cb8-66" data-line-number="66">  title = "How to avoid privacy and security issues?",</a>
<a class="sourceLine" id="cb8-67" data-line-number="67">  answer("Ensure the DB instance is running in the correct AWS region.", correct = TRUE),</a>
<a class="sourceLine" id="cb8-68" data-line-number="68">  answer("Use a complex master password for the DB instance and not share it.", correct = TRUE),</a>
<a class="sourceLine" id="cb8-69" data-line-number="69">  answer("Do **not** add exercise question as they may expose the database credentials", correct = TRUE),</a>
<a class="sourceLine" id="cb8-70" data-line-number="70">  answer("Use a random endpoint URL for the DB instance."),</a>
<a class="sourceLine" id="cb8-71" data-line-number="71">  answer("Do not tell anybody that the database is hosted on AWS RDS."),</a>
<a class="sourceLine" id="cb8-72" data-line-number="72">  answer("Amazon AWS guarantees security of the data and that privacy issues are avoided.")</a>
<a class="sourceLine" id="cb8-73" data-line-number="73">)</a>
<a class="sourceLine" id="cb8-74" data-line-number="74">```</a></code></pre></div>
</div>
<div id="step-3-publishing-the-exam-to-shinyapps-io" class="section level2">
<h2 class="hasAnchor">
<a href="#step-3-publishing-the-exam-to-shinyapps-io" class="anchor"></a>Step 3: Publishing the exam to shinyapps.io</h2>
<p>First you need to install the latest version of the rsconnect package by running the following R command:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'rsconnect'</span><span class="op">)</span></code></pre></div>
<p>You need to authorize RStudio to publish documents to your shinyapps.io account by following the instructions in the <a href="https://shiny.rstudio.com/articles/shinyapps.html">shiny documentation</a>.</p>
<p>Once you completed the exam document, click on <em>Publish Document…</em> in the top right corner of the RStudio IDE. On the left the <em>.Rmd</em> file, the database credentials (<em>www/pgauth.yaml</em>) and any other resource file the exam needs. On the right, select your shinyapps.io account and set the name of the exam and click <em>Publish</em>.</p>
</div>
<div id="scaling-updown-to-meet-your-demand" class="section level2">
<h2 class="hasAnchor">
<a href="#scaling-updown-to-meet-your-demand" class="anchor"></a>Scaling up/down to meet your demand</h2>
<p>The database instance on AWS RDS and the shiny server on shinyapps.io can be scaled up if your exam needs to be accessed by a larger number of learners. You can also monitor the load of the DB instance and your shiny app to decide if more resources are needed for your number of learners. Note, however, that scaling the shiny server or DB instance up/down will take them offline for several minutes, making the exam inaccessible during this time. If you are not sure if your number of learners will require more resources than available for free, it is suggested to administer a low-stakes exam to your learners and monitor the load of the DB instance and shiny server. If you notice the any of the services buckle under the load, you have to consider scaling up the resources.</p>
<p>In most use-cases it would also make sense to scale up resources for the duration of the actual exam (when many learners access the exam at the same time) and scale back down after the exam. Grading and accessing feedback are typically less demanding as the load is spread more over time. In many cases, a large number of learners submits the exam at the same time, leading to a very high load on the database and shiny server for a brief moment. Being able to handle these substantial spikes is important for a smooth exam experience. After this rush, however, demand will be minimal.</p>
<div id="scaling-the-db-instance" class="section level3">
<h3 class="hasAnchor">
<a href="#scaling-the-db-instance" class="anchor"></a>Scaling the DB instance</h3>
<p>AWS RDS offers a wide range of instance sizes. The free tier applies only to the smallest instance (currently <code>db.t3.micro</code>). For most exams, “burstable” instance classes are sufficient and much cheaper than standard or optimized instance classes.</p>
<p>You can also stop the DB instance during times where no exam needs to be accessible. You will not be billed for computing time while the instance is stopped, but the charges for storage will continue. The size of the exam data, however, is small and would not incur high costs.</p>
</div>
<div id="scaling-the-shiny-server" class="section level3">
<h3 class="hasAnchor">
<a href="#scaling-the-shiny-server" class="anchor"></a>Scaling the shiny server</h3>
<p>Your shinyapps.io account gives you the option to purchase monthly or yearly plans. You would only get more resources when subscribing to at least the <em>Basic</em> plan. These plans allow you to use more than 1 instance and more than 1 worker process per instance for your exam.</p>
<p>To increase the number of instances/worker processes for your exam, go to your exam shiny app on shinyapps.io and click on <em>Settings</em>. Here you have three main knobs to increase the number of learners you can serve simultaneously:</p>
<ul>
<li>Under <em>General</em>, you can select a larger instance size; the more memory the more learners you can serve.</li>
<li>Under <em>Advanced</em>, you can set:
<ul>
<li>The start count under instance settings determines how many instances are started at the beginning. If you expect all your learners to access the exam at the same time, this should be set to the maximum value (depends on your plan). Note that a larger number of instances depletes your allocated number of active hours more quickly.</li>
<li>The maximum number of worker processes (up to 10). All these processes run in the same instance, so 10 processes may even slow down the server. It is suggested to use 3 — 6 processes.</li>
</ul>
</li>
</ul>
<p>You should ensure that your plan allows you to have enough instances number of worker processes such that your exam can serve the expected number of learners:</p>
<p><span class="math display">\[
\text{Number of learners} &gt; \text{Max Worker Processes} \times \text{Maximum Instances Limit} \times \text{Max Connections}
\]</span></p>
<p>The <a href="https://docs.rstudio.com/shinyapps.io/applications.html">shinyapps.io user guide</a> has comprehensive information on setting and tuning application performance.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Kepplinger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
