<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Randomizing exams • examinr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Randomizing exams">
<meta property="og:description" content="examinr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">examinr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/examinr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Content</li>
    <li>
      <a href="../articles/randomized_exam.html">Randomization</a>
    </li>
    <li>
      <a href="../articles/question_types.html">Question types</a>
    </li>
    <li>
      <a href="../articles/exercises.html">Coding exercises</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/grading.html">Grading</a>
    </li>
    <li>
      <a href="../articles/deployment.html">Deploying</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Configuration</li>
    <li>
      <a href="../articles/config_access.html">Controlling access to exams</a>
    </li>
    <li>
      <a href="../articles/config_storage.html">Storage configuration</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dakep/examinr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><link href="randomized_exam_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="randomized_exam_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Randomizing exams</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dakep/examinr/blob/master/vignettes/randomized_exam.Rmd"><code>vignettes/randomized_exam.Rmd</code></a></small>
      <div class="hidden name"><code>randomized_exam.Rmd</code></div>

    </div>

    
    
<p>Almost every aspect of an exam can be randomized: section order, question texts (text blocks, question titles, answer options, etc, correct answers, etc), and exercises. Randomization is based on exam-specific data providers: one for question texts and one for exercise chunks. Question texts only have access to data generated by the data provider set in the <em>setup</em> chunk via <code><a href="../reference/exam_config.html">data_provider()</a></code>. Exercise code only has access to data generated by the exercise data provider set via <code><a href="../reference/exam_config.html">exam_config(exercise_data_provider=)</a></code>.</p>
<div id="randomization-in-questions-and-text-blocks" class="section level2">
<h2 class="hasAnchor">
<a href="#randomization-in-questions-and-text-blocks" class="anchor"></a>Randomization in questions and text blocks</h2>
<p>The only R objects accessible in the main body of the R Markdown document are the ones returned by the data provider set via <code><a href="../reference/exam_config.html">data_provider()</a></code>. The data provider is a function which generates all (randomized) data which may change between users and attempts. It receives arguments <code>section</code> (identifier of the currently visible section), <code>attempt</code> (information about the current attempt), <code>session</code> (the current Shiny session object), and <code>...</code> (for future expansions). Arguments <code>attempt</code> and <code>session</code> may be <code>NULL</code> if the data provider is invoked during pre-rendering of the exam. The function must return either a <code>list</code> or an <code>environment</code> (the parent environment will be stripped). Before calling the data provider, the seed for the RNG is automatically set according to the current attempt to ensure the data provider always returns the same values for a given attempt. The data provider is not only invoked when displaying the exam to the user, but also when pre-rendering the exam, when showing feedback and when grading.</p>
<p>For progressive exams, the data provider is invoked for a specific section, while in any other case it is invoked with <code>section = TRUE</code>.</p>
<p>As example, consider the following data provider:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/exam_config.html">data_provider</a></span><span class="op">(</span><span class="kw">function</span> <span class="op">(</span><span class="va">section</span>, <span class="va">attempt</span>, <span class="va">session</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Create the environment and some values used in all sections:</span>
  <span class="va">objs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">8</span><span class="op">:</span><span class="fl">14</span>, <span class="fl">1</span><span class="op">)</span>,
               sample_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,
               sample_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

  <span class="va">section_seeds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample.int</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">integer.max</span>, <span class="fl">2</span><span class="op">)</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">section</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">section</span>, <span class="st">'maximum-likelihood-estimation'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># For MLE, users need an actual sample</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">section_seeds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
    <span class="va">objs</span><span class="op">$</span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">objs</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">sample_sd</span> <span class="op">+</span> <span class="va">sample_mean</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">section</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">section</span>, <span class="st">'confidence-interval'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># In the confidence interval section we ask for a specific confidence level.</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">section_seeds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
    <span class="va">objs</span><span class="op">$</span><span class="va">conf_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.995</span>, <span class="fl">0.99</span>, <span class="fl">0.975</span>, <span class="fl">0.95</span>, <span class="fl">0.90</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">objs</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>There are a few important guidelines for writing your own the data provider. First and foremost, section-specific randomization <strong>must not interfere</strong> with each other. This ensures that calling the data provider with <code>section = TRUE</code> gives the same values, e.g., for <code>conf_level</code>, as if calling the data provider with <code>section = 'confidence-interval'</code>. The data provider will always be called with <code>section = TRUE</code> when showing feedback to users and when grading, as in these cases all sections are shown at once. For progressive exams, however, the data provider is called only for the currently visible section. Furthermore, for performance reasons it is good practice to only generate the data for the requested sections.</p>
<p>In the example above, section-specific randomization is done by setting a section-specific seed when generating the data for the individual sections. Another option would be to use <a href="https://withr.r-lib.org/reference/with_seed.html"><code>withr::with_preserve_seed()</code></a>.</p>
<p>If the generated data is small but takes a long time to compute, consider caching the data by setting <code><a href="../reference/exam_config.html">data_provider(cache_data = TRUE)</a></code>. This will cache the generated data in the Shiny session and the data provider will be invoked only once for every attempt and section.</p>
<div id="using-randomized-values" class="section level3">
<h3 class="hasAnchor">
<a href="#using-randomized-values" class="anchor"></a>Using randomized values</h3>
<p>Using randomized data in an exam document is the same as using R objects in a standard R Markdown document: via R code chunks. The section on confidence intervals, for example, may look something like</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb2-1" data-line-number="1">```{r setup}</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="fu"># Set the data provider in the setup chunk</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">data_provider(function (section, attempt, session, ...) {</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  # Create the environment and some values used in all sections:</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  objs &lt;- list(sample_size = sample(8:14, 1),</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="bn">               sample_mean = round(rnorm(1, mean = 100), 1),</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="bn">               sample_sd = round(runif(1, 1, 3), 1))</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  section_seeds &lt;- sample.int(.Machine$integer.max, 2)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  if (isTRUE(section) || identical(section, 'maximum-likelihood-estimation')) {</a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="bn">    # For MLE, users need an actual sample</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="bn">    set.seed(section_seeds[1])</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="bn">    objs$sample &lt;- with(objs, round(rnorm(sample_size), 2) * sample_sd + sample_mean)</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15">  }</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb2-17" data-line-number="17">  if (isTRUE(section) || identical(section, 'confidence-interval')) {</a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="bn">    # In the confidence interval section we ask for a specific confidence level.</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="bn">    set.seed(section_seeds[2])</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="bn">    objs$conf_level &lt;- sample(c(0.995, 0.99, 0.975, 0.95, 0.90), 1)</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21">  }</a>
<a class="sourceLine" id="cb2-22" data-line-number="22">  </a>
<a class="sourceLine" id="cb2-23" data-line-number="23">  return(objs)</a>
<a class="sourceLine" id="cb2-24" data-line-number="24">})</a>
<a class="sourceLine" id="cb2-25" data-line-number="25">```</a>
<a class="sourceLine" id="cb2-26" data-line-number="26"></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="fu"># Confidence interval</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"></a>
<a class="sourceLine" id="cb2-29" data-line-number="29">As before, the sample size is $n = <span class="bn">`r sample_size`</span>$ and the maximum likelihood estimate for the</a>
<a class="sourceLine" id="cb2-30" data-line-number="30">mean is $\hat\mu = <span class="bn">`r sample_mean`</span>$.</a>
<a class="sourceLine" id="cb2-31" data-line-number="31">Moreover, the sample standard deviation is $s = <span class="bn">`r sample_sd`</span>$.</a>
<a class="sourceLine" id="cb2-32" data-line-number="32"></a>
<a class="sourceLine" id="cb2-33" data-line-number="33">```{r ci_q_1}</a>
<a class="sourceLine" id="cb2-34" data-line-number="34">text_question(</a>
<a class="sourceLine" id="cb2-35" data-line-number="35">  title = r"(What is the lower endpoint of the <span class="bn">`r conf_level * 100`</span>% confidence interval for $\mu$?)",</a>
<a class="sourceLine" id="cb2-36" data-line-number="36">  type = "numeric", accuracy = 1e-3,</a>
<a class="sourceLine" id="cb2-37" data-line-number="37">  solution = {</a>
<a class="sourceLine" id="cb2-38" data-line-number="38"><span class="bn">    t_quantile &lt;- 1 - (1 - conf_level) / 2</span></a>
<a class="sourceLine" id="cb2-39" data-line-number="39"><span class="bn">    ci_lower &lt;- sample_mean - qt(t_quantile, df = sample_size - 1) * sample_sd / sqrt(sample_size)</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"><span class="bn">    structure(sprintf(r"[The lower endpoint of the CI is $\displaystyle \hat\mu - t_{n,%.4f} \times</span></a>
<a class="sourceLine" id="cb2-41" data-line-number="41"><span class="bn">                         \frac{s}{\sqrt{n}} = %.3f$]", t_quantile, ci_lower),</span></a>
<a class="sourceLine" id="cb2-42" data-line-number="42"><span class="bn">              answer = ci_lower)</span></a>
<a class="sourceLine" id="cb2-43" data-line-number="43">  })</a>
<a class="sourceLine" id="cb2-44" data-line-number="44">```</a></code></pre></div>
<p><em>(Note: the above R code chunk uses raw character constants as introduced in R 4.0, avoiding the need to double-escape backslashes in the MathJax equations.)</em></p>
<p>The R objects generated by the data provider are used via inline R code chunks in the question text and in the question title. The rendered section looks like this:</p>
<div class="figure">
<img src="figures/randomized_exam/ci_user.png" alt="Confidence interval section as shown to a user during the exam." style="width:75.0%"><p class="caption">Confidence interval section as shown to a user during the exam.</p>
</div>
<p>The data from the data provider is also available when computing the solution to the question. The <code>solution</code> expression is evaluated in an environment generated from the value returned by the data provider. The feedback to the user looks like this:</p>
<div class="figure">
<img src="figures/randomized_exam/ci_feedback.png" alt="Feedback on the confidence interval section." style="width:75.0%"><p class="caption">Feedback on the confidence interval section.</p>
</div>
<div id="performance-considerations" class="section level4">
<h4 class="hasAnchor">
<a href="#performance-considerations" class="anchor"></a>Performance considerations</h4>
<p>Prefer inline R code chunks (i.e.,<code>`r ...`</code>) over R code blocks of the form</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb3-1" data-line-number="1">```{r}</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="fu"># ...</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">```</a></code></pre></div>
<p>If the section contains only inline R chunks, examinr uses <code><a href="https://rdrr.io/pkg/commonmark/man/commonmark.html">commonmark::markdown_html()</a></code> to parse the markdown to HTML. Whenever a section contains R code blocks, however, <code><a href="https://rdrr.io/pkg/rmarkdown/man/render.html">rmarkdown::render()</a></code> function is invoked which is much slower. This will be important if many users access the exam at the same time and the same R process.</p>
</div>
</div>
</div>
<div id="randomization-in-exercises" class="section level2">
<h2 class="hasAnchor">
<a href="#randomization-in-exercises" class="anchor"></a>Randomization in exercises</h2>
<p>Exercises are slightly different than regular question texts in that the data available in the exercises is generated via the exercise data provider configured with <code><a href="../reference/exam_config.html">exam_config(exercise_data_provider=)</a></code>.</p>
<p>The exercise data provider is invoked when the user runs their code for an exercise chunk and when examinr builds the information needed for auto-completion. The exercise data provider is invoked with arguments <code>label</code> (identifier of the exercise chunk), <code>attempt</code> (information about the current attempt), <code>session</code> (the current Shiny session object), and <code>...</code> (for future expansions). Arguments <code>attempt</code> and <code>session</code> are <code>NULL</code> when the provider is invoked for determining the objects available for auto-completion. The restrictions and notes given above for the data provider also apply to the exercise data provider.</p>
<p>In many situations, the data provider and the exercise data provider share many objects. In these cases, it is sensible to write a helper function (below called <code>common_data_provider()</code>) which generates the data and is invoked by both data providers, for instance</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">common_data_provider</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">section</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Create the environment and some values used in all sections:</span>
  <span class="va">objs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">8</span><span class="op">:</span><span class="fl">14</span>, <span class="fl">1</span><span class="op">)</span>,
               sample_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,
               sample_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

  <span class="va">section_seeds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample.int</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">integer.max</span>, <span class="fl">2</span><span class="op">)</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">section</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">section</span>, <span class="st">'maximum-likelihood-estimation'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># For MLE, users need an actual sample</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">section_seeds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
    <span class="va">objs</span><span class="op">$</span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">objs</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">sample_size</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">sample_sd</span> <span class="op">+</span> <span class="va">sample_mean</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">section</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">section</span>, <span class="st">'confidence-interval'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># In the confidence interval section we ask for a specific confidence level.</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">section_seeds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
    <span class="va">objs</span><span class="op">$</span><span class="va">conf_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.995</span>, <span class="fl">0.99</span>, <span class="fl">0.975</span>, <span class="fl">0.95</span>, <span class="fl">0.90</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">objs</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>In this example, the data provider may simply forward to the common data provider:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set the data provider in the setup chunk</span>
<span class="fu"><a href="../reference/exam_config.html">data_provider</a></span><span class="op">(</span><span class="kw">function</span> <span class="op">(</span><span class="va">section</span>, <span class="va">attempt</span>, <span class="va">session</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">common_data_provider</span><span class="op">(</span><span class="va">section</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>The exercise data provider, on the other hand, would return only the objects the user should have access to in the exercise chunk:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set the data provider in a "server-start" chunk</span>
<span class="fu"><a href="../reference/exam_config.html">exam_config</a></span><span class="op">(</span>exercise_data_provider <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="va">label</span>, <span class="va">attempt</span>, <span class="va">session</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">label</span>, <span class="st">'mle_q_1'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">objs</span> <span class="op">&lt;-</span> <span class="fu">common_data_provider</span><span class="op">(</span><span class="st">'maximum-likelihood-estimation'</span><span class="op">)</span>
    <span class="co"># For this exercise, the user only needs access to the sample.</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">objs</span><span class="op">[</span><span class="st">'sample'</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>Note that the data provider must be set in a <em>setup</em> chunk (it must be available both at rendering time and on the server), while the exercise data provider is set only in a <em>server-start</em> context.</p>
<p>The section on maximum likelihood estimation may then look something like</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb7-1" data-line-number="1">```{r setup}</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">common_data_provider &lt;- function (section) {</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  # Create the environment and some values used in all sections:</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  objs &lt;- list(sample_size = sample(8:14, 1),</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="bn">               sample_mean = round(rnorm(1, mean = 100), 1),</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="bn">               sample_sd = round(runif(1, 1, 3), 1))</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">  section_seeds &lt;- sample.int(.Machine$integer.max, 2)</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb7-10" data-line-number="10">  if (isTRUE(section) || identical(section, 'maximum-likelihood-estimation')) {</a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="bn">    # For MLE, users need an actual sample</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="bn">    set.seed(section_seeds[1])</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="bn">    objs$sample &lt;- with(objs, round(rnorm(sample_size), 2) * sample_sd + sample_mean)</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14">  }</a>
<a class="sourceLine" id="cb7-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb7-16" data-line-number="16">  if (isTRUE(section) || identical(section, 'confidence-interval')) {</a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="bn">    # In the confidence interval section we ask for a specific confidence level.</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="bn">    set.seed(section_seeds[2])</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="bn">    objs$conf_level &lt;- sample(c(0.995, 0.99, 0.975, 0.95, 0.90), 1)</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20">  }</a>
<a class="sourceLine" id="cb7-21" data-line-number="21">  </a>
<a class="sourceLine" id="cb7-22" data-line-number="22">  return(objs)</a>
<a class="sourceLine" id="cb7-23" data-line-number="23">}</a>
<a class="sourceLine" id="cb7-24" data-line-number="24">data_provider(function (section, attempt, session, ...) {</a>
<a class="sourceLine" id="cb7-25" data-line-number="25">  return(common_data_provider(section))</a>
<a class="sourceLine" id="cb7-26" data-line-number="26">})</a>
<a class="sourceLine" id="cb7-27" data-line-number="27">```</a>
<a class="sourceLine" id="cb7-28" data-line-number="28"></a>
<a class="sourceLine" id="cb7-29" data-line-number="29">```{r, context="server-start"}</a>
<a class="sourceLine" id="cb7-30" data-line-number="30">exam_config(exercise_data_provider = function (label, attempt, session, ...) {</a>
<a class="sourceLine" id="cb7-31" data-line-number="31">  if (identical(label, 'mle-q-1')) {</a>
<a class="sourceLine" id="cb7-32" data-line-number="32"><span class="bn">    objs &lt;- common_data_provider('maximum-likelihood-estimation')</span></a>
<a class="sourceLine" id="cb7-33" data-line-number="33"><span class="bn">    # For this exercise, the user only needs access to the sample.</span></a>
<a class="sourceLine" id="cb7-34" data-line-number="34"><span class="bn">    return(objs['sample'])</span></a>
<a class="sourceLine" id="cb7-35" data-line-number="35">  }</a>
<a class="sourceLine" id="cb7-36" data-line-number="36">  return(list())</a>
<a class="sourceLine" id="cb7-37" data-line-number="37">})</a>
<a class="sourceLine" id="cb7-38" data-line-number="38">```</a>
<a class="sourceLine" id="cb7-39" data-line-number="39"></a>
<a class="sourceLine" id="cb7-40" data-line-number="40"><span class="fu"># Maximum Likelihood Estimation</span></a>
<a class="sourceLine" id="cb7-41" data-line-number="41"></a>
<a class="sourceLine" id="cb7-42" data-line-number="42">Let $X_1, \dotsc, X_n$ be independent normal random variables, each with mean $\mu$ and variance</a>
<a class="sourceLine" id="cb7-43" data-line-number="43">$\sigma^2$.</a>
<a class="sourceLine" id="cb7-44" data-line-number="44">The goal is to find the maximum likelihood estimate for $\mu$ from such a sample of size</a>
<a class="sourceLine" id="cb7-45" data-line-number="45">$n = <span class="bn">`r sample_size`</span>$.</a>
<a class="sourceLine" id="cb7-46" data-line-number="46"></a>
<a class="sourceLine" id="cb7-47" data-line-number="47">In the code chunk below, the sample is available as R object <span class="bn">`sample`</span>.</a>
<a class="sourceLine" id="cb7-48" data-line-number="48">Write the R code to compute the maximum likelihood estimate $\hat\mu$.</a>
<a class="sourceLine" id="cb7-49" data-line-number="49"></a>
<a class="sourceLine" id="cb7-50" data-line-number="50"></a>
<a class="sourceLine" id="cb7-51" data-line-number="51">```{r mle_q_1, exercise=TRUE, exercise.solution="mle_q_1-solution"}</a>
<a class="sourceLine" id="cb7-52" data-line-number="52"><span class="fu"># Compute the maximum likelihood estimate.</span></a>
<a class="sourceLine" id="cb7-53" data-line-number="53">```</a>
<a class="sourceLine" id="cb7-54" data-line-number="54"></a>
<a class="sourceLine" id="cb7-55" data-line-number="55">```{r mle_q_1-solution, eval=FALSE}</a>
<a class="sourceLine" id="cb7-56" data-line-number="56"><span class="fu"># The MLE for the mean parameter is the mean of the observed values:</span></a>
<a class="sourceLine" id="cb7-57" data-line-number="57">mu_mle &lt;- mean(sample)</a>
<a class="sourceLine" id="cb7-58" data-line-number="58">```</a></code></pre></div>
<p>The user would see something like the following:</p>
<div class="figure">
<img src="figures/randomized_exam/mle_user.png" alt="Exercise chunk with randomized data." style="width:75.0%"><p class="caption">Exercise chunk with randomized data.</p>
</div>
<p>If computations in the exercise data provider are slow, but the data itself is small, consider caching the results with <code><a href="../reference/exam_config.html">exam_config(cache_data = TRUE)</a></code>.</p>
<div id="randomization-and-setup-chunks" class="section level3">
<h3 class="hasAnchor">
<a href="#randomization-and-setup-chunks" class="anchor"></a>Randomization and setup chunks</h3>
<p>Exercises also support setup chunks which are always run immediately before the user code. Setup chunks see the same environment as the user code and thus has access to the data created by the exercise data provider. The RNG is not seeded before running setup chunks (or user code), and therefore cannot be used directly to create reproducible data for users.</p>
<p>Setup chunks are useful for transforming the data generated by the data provider, e.g., saving the data to disk for the user to read in. An alternative version of the MLE question from above could be</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb8-1" data-line-number="1">&lt;!--<span class="co"> setup the data providers as above --&gt;</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="fu"># Maximum Likelihood Estimation</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">Let $X_1, \dotsc, X_n$ be independent normal random variables, each with mean $\mu$ and variance</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">$\sigma^2$.</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">The goal is to find the maximum likelihood estimate for $\mu$ from such a sample of size</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">$n = <span class="bn">`r sample_size`</span>$.</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">In the code chunk below, the sample is available in the file _./sample.csv_.</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">Write the R code to read in the data and compute the maximum likelihood estimate $\hat\mu$.</a>
<a class="sourceLine" id="cb8-12" data-line-number="12"></a>
<a class="sourceLine" id="cb8-13" data-line-number="13">```{r mle_q_1-setup}</a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="fu"># Write data to disk and hide from the user</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15">write.csv(data.frame(x = sample), file = "sample.csv", row.names = FALSE)</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">rm(sample)</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">```</a>
<a class="sourceLine" id="cb8-18" data-line-number="18"></a>
<a class="sourceLine" id="cb8-19" data-line-number="19">```{r mle_q_1, exercise=TRUE, exercise.solution="mle_q_1-setup", exercise.solution="mle_q_1-solution"}</a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="fu"># Read in the data and compute the maximum likelihood estimate.</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21">```</a>
<a class="sourceLine" id="cb8-22" data-line-number="22"></a>
<a class="sourceLine" id="cb8-23" data-line-number="23">```{r mle_q_1-solution, eval=FALSE}</a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="fu"># Read in the sample values</span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25">sample &lt;- read.csv("sample.csv")</a>
<a class="sourceLine" id="cb8-26" data-line-number="26"><span class="fu"># The MLE for the mean parameter is the mean of the observed values:</span></a>
<a class="sourceLine" id="cb8-27" data-line-number="27">mu_mle &lt;- mean(sample$x)</a>
<a class="sourceLine" id="cb8-28" data-line-number="28">```</a></code></pre></div>
<p>More information on using setup and solution chunks is available the <a href="exercises.html">companion vignette on exercise chunks</a>.</p>
</div>
</div>
<div id="customizing-the-seed" class="section level2">
<h2 class="hasAnchor">
<a href="#customizing-the-seed" class="anchor"></a>Customizing the seed</h2>
<p>By default, all attempts by a user will be seeded with the same seed determined from the user’s id. Sometimes, it is useful to use different seeds for different attempts, or maybe the same seed for several users. To customize the seed used for an attempt, you can specify a seeding function via <code><a href="../reference/exam_config.html">exam_config(seed_attempt=)</a></code>. The seeding function is called arguments <code>user</code> (the current user), <code>previous_attempts</code> (a list of all previous attempts by this user), and <code>...</code> (for future expansion). It should return a single integer which will be used to seed the RNG for the attempt.</p>
<p>To give different seeds for every attempt, for example, you can use the following:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/exam_config.html">exam_config</a></span><span class="op">(</span>seed_attempt <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="va">user</span>, <span class="va">previous_attempts</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">digest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/digest/man/digest2int.html">digest2int</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">user</span><span class="op">$</span><span class="va">user_id</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">previous_attempts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>The <a href="congi_access.html#authentication-provider">companion vignette on controlling access to exams</a> contains more information about the user object.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Kepplinger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
