<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deploying exams • examinr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Deploying exams">
<meta property="og:description" content="examinr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">examinr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/examinr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Content</li>
    <li>
      <a href="../articles/randomized_exam.html">Randomization</a>
    </li>
    <li>
      <a href="../articles/question_types.html">Question types</a>
    </li>
    <li>
      <a href="../articles/exercises.html">Coding exercises</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/grading.html">Grading</a>
    </li>
    <li>
      <a href="../articles/deployment.html">Deploying</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Configuration</li>
    <li>
      <a href="../articles/navigation.html">Section navigation</a>
    </li>
    <li>
      <a href="../articles/config_access.html">Controlling access to exams</a>
    </li>
    <li>
      <a href="../articles/config_storage.html">Storage configuration</a>
    </li>
    <li>
      <a href="../articles/localization.html">Localization</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dakep/examinr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Deploying exams</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dakep/examinr/blob/master/vignettes/deployment.Rmd"><code>vignettes/deployment.Rmd</code></a></small>
      <div class="hidden name"><code>deployment.Rmd</code></div>

    </div>

    
    
<p>Exams can be easily developed and debugged locally, but to make them available to your learners, you must deploy the exam to a Shiny server. Deploying the exam requires you to think, at least a little bit, about some of the more technical details of the server infrastructure.</p>
<div id="security-considerations" class="section level2">
<h2 class="hasAnchor">
<a href="#security-considerations" class="anchor"></a>Security considerations</h2>
<p>As explained also in the <a href="exercises.html">companion vignette on coding exercises</a>, coding exercise allow learners to run arbitrary R code on the server. This is a big security issue, as learners may</p>
<ul>
<li>access confidential information,</li>
<li>inject harmful code and take over the server,</li>
<li>disrupt the exam for everyone.</li>
</ul>
<p>You need to take precautions to limit the access learners get to the server when running exercise code. Most importantly, the user running the shiny process (not to be confused with the <em>user</em> taking the exam) should have as restrictive permissions on the server as possible. See the documentation for your shiny server to find out how to set the user running the shiny app process. The default <code><a href="../reference/exercise_evaluator.html">future_evaluator()</a></code> sanitizes the environment variables available to the R process, but the R process still has the same privileges as the shiny process. You are strongly encouraged to use <a href="https://cran.r-project.org/package=RAppArmor">RAppArmor</a> to restrict the permissions of the R process executing the learners’ code.</p>
</div>
<div id="database-connection" class="section level2">
<h2 class="hasAnchor">
<a href="#database-connection" class="anchor"></a>Database connection</h2>
<p>If you don’t have much experience with server administration, setting up the database to store the exam data may be the most intriguing challenge for deploying exams. If you have only a small number of learners (&lt; 30), you can choose to use a local SQLite database via the <a href="https://cran.r-project.org/package=RSQLite">RSQLite package</a>.</p>
<p>An SQLite database, which is basically a single file, can be easily set up from within R and you don’t need any other software on the server. You must create a separate SQLite database for each exam.</p>
<p><strong>Important:</strong> if you choose to use an SQlite database and if you use RStudio Connect, Shiny Server Pro, or any other shiny server where the exam would be distributed across several processes, you must limit it to <strong>only 1 process</strong>. SQLite databases don’t support concurrent access. You can, however, use multiple processes to evaluate coding exercises, if you use them in your exam.</p>
<p>For larger numbers of learners, there is unfortunately no way around configuring a more potent storage provider.</p>
<p>Setting up the required SQLite database can be done from within R, executed on the server. Note that the path to the database file (in the code chunk below <em>/var/run/examinr-my_first_exam.sqlite</em> must be writable by the user creating the database and the user running the shiny process:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RSQLite</span><span class="op">)</span>
<span class="co"># Create an SQLite database for the exam "my_first_exam"</span>
<span class="va">db_con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu">SQLite</span><span class="op">(</span><span class="op">)</span>, <span class="st">"/var/run/examinr-my_first_exam.sqlite"</span><span class="op">)</span>

<span class="co"># Create the attempts table (SQLite doesn't have a UUID type)</span>
<span class="fu">dbExecute</span><span class="op">(</span><span class="va">db_con</span>, <span class="st">'CREATE TABLE attempts (
  attempt_id   varchar(36) PRIMARY KEY,
  user_id      varchar(64) NOT NULL,
  exam_id      varchar(64) NOT NULL,
  exam_version varchar(64) NOT NULL,
  user_obj     text        NOT NULL,
  seed         integer     NOT NULL,
  started_at   timestamp   NOT NULL DEFAULT CURRENT_TIMESTAMP,
  finished_at  timestamp,
  points       text
)'</span><span class="op">)</span>
<span class="co"># Create an index on the attempts table</span>
<span class="fu">dbExecute</span><span class="op">(</span><span class="va">db_con</span>, <span class="st">'CREATE INDEX attempts_index ON attempts (user_id, exam_id, exam_version)'</span><span class="op">)</span>

<span class="co"># Create the section data table</span>
<span class="fu">dbExecute</span><span class="op">(</span><span class="va">db_con</span>, <span class="st">'CREATE TABLE section_data (
  id           integer      PRIMARY KEY,
  attempt_id   varchar(36)  NOT NULL,
  section      varchar(64)  NOT NULL,
  saved_at     timestamp    NOT NULL DEFAULT CURRENT_TIMESTAMP,
  section_data text
)'</span><span class="op">)</span>
<span class="co"># Create an index on the section data table</span>
<span class="fu">dbExecute</span><span class="op">(</span><span class="va">db_con</span>, <span class="st">'CREATE INDEX section_data_index ON section_data (attempt_id, section)'</span><span class="op">)</span></code></pre></div>
<p>This must be done for every exam, such that you have one database file per exam.</p>
<p>In your exam document, you would configure the <code><a href="../reference/dbi_storage_provider.html">dbi_storage_provider()</a></code> as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#! context="server-start"</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/pool">pool</a></span><span class="op">)</span>

<span class="co"># Create a pool of connections to your SQLite database.</span>
<span class="co"># Important: minSize and maxSize must be 1, as SQLite does not support more than one connection!</span>
<span class="va">db_pool</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pool/man/dbPool.html">dbPool</a></span><span class="op">(</span>drv <span class="op">=</span> <span class="fu">RSQLite</span><span class="fu">::</span><span class="fu">SQLite</span><span class="op">(</span><span class="op">)</span>,
                  dbname <span class="op">=</span> <span class="st">"/var/run/examinr-my_first_exam.sqlite"</span>,
                  minSize <span class="op">=</span> <span class="fl">1</span>,
                  maxSize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="co"># Close all connections in the pool shiny stops</span>
<span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/onStop.html">onStop</a></span><span class="op">(</span><span class="kw">function</span> <span class="op">(</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/pkg/pool/man/Pool-class.html">poolClose</a></span><span class="op">(</span><span class="va">db_pool</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span>

<span class="co"># Use this database as storage for the exam</span>
<span class="fu"><a href="../reference/exam_config.html">exam_config</a></span><span class="op">(</span>storage_provider <span class="op">=</span> <span class="fu"><a href="../reference/dbi_storage_provider.html">dbi_storage_provider</a></span><span class="op">(</span><span class="va">db_pool</span>, <span class="st">'attempts'</span>, <span class="st">'section_data'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Kepplinger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
