<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Storage configuration • examinr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Storage configuration">
<meta property="og:description" content="examinr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">examinr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/examinr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Content</li>
    <li>
      <a href="../articles/randomized_exam.html">Randomization</a>
    </li>
    <li>
      <a href="../articles/question_types.html">Question types</a>
    </li>
    <li>
      <a href="../articles/exercises.html">Coding exercises</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/grading.html">Grading</a>
    </li>
    <li>
      <a href="../articles/deployment_shinyapps.html">Deploying to shinyapps.io</a>
    </li>
    <li>
      <a href="../articles/deployment.html">Deploying (general)</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Configuration</li>
    <li>
      <a href="../articles/navigation.html">Section navigation</a>
    </li>
    <li>
      <a href="../articles/config_access.html">Controlling access to exams</a>
    </li>
    <li>
      <a href="../articles/config_storage.html">Storage configuration</a>
    </li>
    <li>
      <a href="../articles/localization.html">Localization</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dakep/examinr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Storage configuration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dakep/examinr/blob/master/vignettes/config_storage.Rmd"><code>vignettes/config_storage.Rmd</code></a></small>
      <div class="hidden name"><code>config_storage.Rmd</code></div>

    </div>

    
    
<p>Exam data needs to be stored somewhere. Examinr does not make any assumption on how or where your data will be stored. You must set the storage provider in the exam configuration via <code><a href="../reference/exam_config.html">exam_config(storage_provider=)</a></code>.</p>
<div id="security-and-privacy" class="section level2">
<h2 class="hasAnchor">
<a href="#security-and-privacy" class="anchor"></a>Security and Privacy</h2>
<p>Please note that examinr stores sensitive information through the storage provider. It is your responsibility to know and understand the privacy legislation governing the data in your jurisdiction. The <code><a href="../reference/dbi_storage_provider.html">dbi_storage_provider()</a></code> provides a simple workaround by <a href="#user-id-hashing">hashing the user id</a>, but this adds another step for you when exporting grades (matching user ids to hashed user ids).</p>
<p>It is recommended that you securely store the data using encryption, but this generally requires more knowledge about the database system in use.</p>
</div>
<div id="dbi-storage-provider" class="section level2">
<h2 class="hasAnchor">
<a href="#dbi-storage-provider" class="anchor"></a>DBI Storage Provider</h2>
<p>With <code><a href="../reference/dbi_storage_provider.html">dbi_storage_provider()</a></code>, examinr supports <a href="https://dbi.r-dbi.org/">DBI</a>-backed storage out of the box. You can leverage this storage provider by calling <code><a href="../reference/exam_config.html">exam_config(storage_provider = dbi_storage_provider(...))</a></code>. You are responsible for the initial setup of the database and establishing a connection with the database, which is passed on to <code><a href="../reference/dbi_storage_provider.html">dbi_storage_provider()</a></code>. In addition to the connection object, the <code><a href="../reference/dbi_storage_provider.html">dbi_storage_provider()</a></code> needs to be told the name of the database tables for storing attempts data and section data (i.e., users’ answers).</p>
<p>The built-in storage provider assumes the following two database tables are read- and writable:</p>
<div id="attempts-table" class="section level4">
<h4 class="hasAnchor">
<a href="#attempts-table" class="anchor"></a>Attempts table</h4>
<table class="table">
<thead><tr class="header">
<th align="left">Field</th>
<th align="left">SQL data type</th>
<th align="left">Storage requirements</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>attempt_id</code></td>
<td align="left">CHAR (or UUID)</td>
<td align="left">36 characters (on database systems which support a UUID type, it should be stored as such)</td>
</tr>
<tr class="even">
<td align="left"><code>user_id</code></td>
<td align="left">CHAR</td>
<td align="left">either 64 characters (if hashing is enabled), or variable length (depending on the authentication provider)</td>
</tr>
<tr class="odd">
<td align="left"><code>exam_id</code></td>
<td align="left">CHAR</td>
<td align="left">variable length</td>
</tr>
<tr class="even">
<td align="left"><code>exam_version</code></td>
<td align="left">CHAR</td>
<td align="left">variable length</td>
</tr>
<tr class="odd">
<td align="left"><code>started_at</code></td>
<td align="left">DOUBLE PRECISION</td>
<td align="left">seconds since 1970-01-01 00:00 UTC (UNIX timestamp)</td>
</tr>
<tr class="even">
<td align="left"><code>seed</code></td>
<td align="left">INTEGER</td>
<td align="left">a signed integer of 4 bytes</td>
</tr>
<tr class="odd">
<td align="left"><code>finished_at</code></td>
<td align="left">DOUBLE PRECISION</td>
<td align="left">seconds since 1970-01-01 00:00 UTC (UNIX timestamp)</td>
</tr>
<tr class="even">
<td align="left"><code>user_obj</code></td>
<td align="left">CHAR</td>
<td align="left">variable length (must be able to hold a serialized R object of arbitrary size)</td>
</tr>
<tr class="odd">
<td align="left"><code>points</code></td>
<td align="left">CHAR</td>
<td align="left">variable length (must be able to hold a serialized R object of arbitrary size)</td>
</tr>
</tbody>
</table>
<p>Some database systems (e.g., PostgreSQL) have native support for a UUID type which should be preferred over character data for the <code>attempts_id</code> field. The <code>attempt_id</code> field should be unique and as such can be used as primary key on the table. The table is mainly queried for a given <code>user_id</code>, <code>exam_id</code> and <code>exam_version</code>. Therefore, it makes sense to add an index (<em>not unique!</em>) spanning these 3 fields to speed up the queries.</p>
<p>Both <code>user_obj</code> and <code>points</code> are serialized R objects and can thus be of arbitrary size. The database should not make any assumption on the size of these fields. Internally, examinr serializes the R objects with <code><a href="https://rdrr.io/r/base/serialize.html">serialize()</a></code> and stores the base64 encoded character string.</p>
<p>An example table definition for PostgreSQL may look like</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> attempts (</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  attempt_id   uuid              <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  user_id      <span class="dt">character</span> <span class="dt">varying</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  exam_id      <span class="dt">character</span> <span class="dt">varying</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  exam_version <span class="dt">character</span> <span class="dt">varying</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  started_at   <span class="dt">double</span> <span class="dt">precision</span>  <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  seed         <span class="dt">integer</span>           <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">  user_obj     text              <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  finished_at  <span class="dt">double</span> <span class="dt">precision</span>,</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">  points       text</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">);</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw">CREATE</span> <span class="kw">INDEX</span> attempts_index <span class="kw">ON</span> attempts (user_id, exam_id, exam_version);</a></code></pre></div>
</div>
<div id="section-data-table" class="section level4">
<h4 class="hasAnchor">
<a href="#section-data-table" class="anchor"></a>Section data table</h4>
<table class="table">
<thead><tr class="header">
<th align="left">Field</th>
<th align="left">SQL data type</th>
<th align="left">Storage requirements</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>attempt_id</code></td>
<td align="left">CHAR (or UUID)</td>
<td align="left">same as for <code>attempt_id</code> of the attempts table</td>
</tr>
<tr class="even">
<td align="left"><code>section</code></td>
<td align="left">CHAR</td>
<td align="left">variable length</td>
</tr>
<tr class="odd">
<td align="left"><code>saved_at</code></td>
<td align="left">DOUBLE PRECISION</td>
<td align="left">seconds since 1970-01-01 00:00 UTC (UNIX timestamp)</td>
</tr>
<tr class="even">
<td align="left"><code>section_data</code></td>
<td align="left">CHAR</td>
<td align="left">variable length (must be able to hold a serialized R object of arbitrary size)</td>
</tr>
</tbody>
</table>
<p>This definition does not have a natural candidate for a primary key, so it is up to you and your database system what kind of primary key you want to use.</p>
<p>The <code>attempt_id</code> field is a reference to the attempt stored in the attempts table. The table is mainly queried for a given <code>attempt_id</code> and <code>section</code>. Therefore, it makes sense to add an index (<em>not unique!</em>) spanning these two fields to speed up the queries.</p>
<p>An example table definition for PostgreSQL may look like:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">CREATE</span> <span class="kw">TABLE</span> section_data (</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="kw">id</span>           serial            <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  attempt_id   uuid              <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">REFERENCES</span> attempts (attempt_id)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">                                          <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span> <span class="kw">ON</span> <span class="kw">UPDATE</span> <span class="kw">CASCADE</span>,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  section      <span class="dt">character</span> <span class="dt">varying</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  saved_at     <span class="dt">double</span> <span class="dt">precision</span>  <span class="kw">NOT</span> <span class="kw">NULL</span>,</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  section_data text</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">);</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="kw">CREATE</span> <span class="kw">INDEX</span> section_data_index <span class="kw">ON</span> section_data (attempt_id, section);</a></code></pre></div>
</div>
<div id="user-id-hashing" class="section level4">
<h4 class="hasAnchor">
<a href="#user-id-hashing" class="anchor"></a>User ID hashing</h4>
<p>User IDs can often be used for identifying individuals and in turn their personal information. In many jurisdictions you must ensure that this information is properly protected. If you don’t have a database with transparent encryption, it is sensible to store a hashed variant of the user id instead of the actual value. The <code><a href="../reference/dbi_storage_provider.html">dbi_storage_provider()</a></code> by default hashes the user id using <code><a href="https://rdrr.io/pkg/digest/man/hmac.html">digest::hmac(key, user_id, algo = "sha256")</a></code> where <code>key</code> is by default the string <code>{exam_id}_{exam_version}</code>. While this ensures the data cannot be traced back to the actual user id by unauthorized third parties, it also prevents you from associating the data (in particular the grading information) with the actual user.</p>
<p>Currently, it is your responsibility to match the hashed user id’s back to the actual users by computing the HMAC of the known user ids and comparing to the hashed user ids in the grading data.</p>
</div>
<div id="example-usages" class="section level3">
<h3 class="hasAnchor">
<a href="#example-usages" class="anchor"></a>Example usages</h3>
<div id="ephemeral-database-for-testing" class="section level4">
<h4 class="hasAnchor">
<a href="#ephemeral-database-for-testing" class="anchor"></a>Ephemeral database for testing</h4>
<p>If you don’t have access to a database server and want to test an examinr exam, an ephemeral in-memory SQLite database is very useful. This database only exists as long as the R server process lives. It can only be used by a single process at a time and as such is not suited for actual exams. For this example you need the <em>RSQLite</em> package.</p>
<p>In the server-start code you have to set up the database and configure the storage provider:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#! context="server-start"</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RSQLite</span><span class="op">)</span>
<span class="co"># Create an ephemeral in-memory RSQLite database</span>
<span class="va">db_con</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span><span class="fu">SQLite</span><span class="op">(</span><span class="op">)</span>, <span class="st">":memory:"</span><span class="op">)</span>

<span class="co"># Create the attempts table (SQLite doesn't have a UUID type)</span>
<span class="fu">dbExecute</span><span class="op">(</span><span class="va">db_con</span>, <span class="st">'CREATE TABLE attempts (
  attempt_id   varchar(36) PRIMARY KEY,
  user_id      varchar(64) NOT NULL,
  exam_id      varchar(64) NOT NULL,
  exam_version varchar(64) NOT NULL,
  user_obj     text        NOT NULL,
  seed         integer     NOT NULL,
  started_at   timestamp   NOT NULL DEFAULT CURRENT_TIMESTAMP,
  finished_at  timestamp,
  points       text
)'</span><span class="op">)</span>
<span class="co"># Create an index on the attempts table</span>
<span class="fu">dbExecute</span><span class="op">(</span><span class="va">db_con</span>, <span class="st">'CREATE INDEX attempts_index ON attempts (user_id, exam_id, exam_version)'</span><span class="op">)</span>

<span class="co"># Create the section data table</span>
<span class="fu">dbExecute</span><span class="op">(</span><span class="va">db_con</span>, <span class="st">'CREATE TABLE section_data (
  id           integer      PRIMARY KEY,
  attempt_id   varchar(36)  NOT NULL,
  section      varchar(64)  NOT NULL,
  saved_at     timestamp    NOT NULL DEFAULT CURRENT_TIMESTAMP,
  section_data text
)'</span><span class="op">)</span>
<span class="co"># Create an index on the section data table</span>
<span class="fu">dbExecute</span><span class="op">(</span><span class="va">db_con</span>, <span class="st">'CREATE INDEX section_data_index ON section_data (attempt_id, section)'</span><span class="op">)</span>

<span class="co"># Disconnect from the DB when shiny stops (this also destroys the ephemeral database!)</span>
<span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/onStop.html">onStop</a></span><span class="op">(</span><span class="kw">function</span> <span class="op">(</span><span class="op">)</span> <span class="op">{</span> <span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">db_con</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span>

<span class="co"># Use this database as storage for the exam</span>
<span class="fu"><a href="../reference/exam_config.html">exam_config</a></span><span class="op">(</span>storage_provider <span class="op">=</span> <span class="fu"><a href="../reference/dbi_storage_provider.html">dbi_storage_provider</a></span><span class="op">(</span><span class="va">db_con</span>, <span class="st">'attempts'</span>, <span class="st">'section_data'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="postgresql-database" class="section level4">
<h4 class="hasAnchor">
<a href="#postgresql-database" class="anchor"></a>PostgreSQL database</h4>
<p>If you have access to a PostgreSQL database it can be used via the <em>RPostgres</em> package. For easy handling of dropped connections, using a pool of database connections via the <em>pool</em> package is generally recommended. First, the database needs to be set up and the tables created according to the table definitions above. The pool is then created in a <em>server-start</em> context and passed on to <code><a href="../reference/dbi_storage_provider.html">dbi_storage_provider()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#! context="server-start"</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/pool">pool</a></span><span class="op">)</span>

<span class="co"># Create a pool of connections to your PostgreSQL database</span>
<span class="va">db_pool</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pool/man/dbPool.html">dbPool</a></span><span class="op">(</span>drv <span class="op">=</span> <span class="fu">RPostgres</span><span class="fu">::</span><span class="fu">Postgres</span><span class="op">(</span><span class="op">)</span>,
                  dbname <span class="op">=</span> <span class="st">"{database name}"</span>,
                  host <span class="op">=</span> <span class="st">"{database host}"</span>,
                  username <span class="op">=</span> <span class="st">"{username}"</span>,
                  password <span class="op">=</span> <span class="st">"{password}"</span>,
                  minSize <span class="op">=</span> <span class="fl">1</span>,
                  maxSize <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="co"># Close all connections in the pool shiny stops</span>
<span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/onStop.html">onStop</a></span><span class="op">(</span><span class="kw">function</span> <span class="op">(</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/pkg/pool/man/Pool-class.html">poolClose</a></span><span class="op">(</span><span class="va">db_pool</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span>

<span class="co"># Use this database as storage for the exam</span>
<span class="fu"><a href="../reference/exam_config.html">exam_config</a></span><span class="op">(</span>storage_provider <span class="op">=</span> <span class="fu"><a href="../reference/dbi_storage_provider.html">dbi_storage_provider</a></span><span class="op">(</span><span class="va">db_pool</span>, <span class="st">'attempts'</span>, <span class="st">'section_data'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note that you won’t need a large pool of connections as each Shiny process can only use one connection at a time anyways. The pool is mostly useful for automatically handling dropped connections.</p>
</div>
</div>
</div>
<div id="writing-your-own-storage-provider" class="section level2">
<h2 class="hasAnchor">
<a href="#writing-your-own-storage-provider" class="anchor"></a>Writing your own storage provider</h2>
<p>If the DBI-backed storage provider does not suit your needs, you can write your own storage provider and configure it via <code><a href="../reference/exam_config.html">exam_config(storage_provider=)</a></code> A storage provider is a list of functions invoked by examinr to read and write all exam data.</p>
<p>The list of functions must include all of the following:</p>
<div id="create_attemptuser-exam_id-exam_version-seed-started_at----" class="section level4">
<h4 class="hasAnchor">
<a href="#create_attemptuser-exam_id-exam_version-seed-started_at----" class="anchor"></a><code>create_attempt(user, exam_id, exam_version, seed, started_at, ...)</code>
</h4>
<p>This function is invoked when a user tries to start a new attempt. The function must return a unique identifier for the attempt, or <code>FALSE</code> in case of an error.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Argument</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>user</code></td>
<td align="left">user object as returned by the <a href="config_access.html#authentication-provider">authentication provider</a>
</td>
</tr>
<tr class="even">
<td align="left"><code>exam_id</code></td>
<td align="left">exam identifier (scalar character)</td>
</tr>
<tr class="odd">
<td align="left"><code>exam_version</code></td>
<td align="left">version string associated with the exam (scalar character)</td>
</tr>
<tr class="even">
<td align="left"><code>seed</code></td>
<td align="left">integer used to seed the attempt (scalar integer)</td>
</tr>
<tr class="odd">
<td align="left"><code>started_at</code></td>
<td align="left">the date-time the attempt was started, including timezone (object of type <code>POSIXct</code>)</td>
</tr>
<tr class="even">
<td align="left"><code>...</code></td>
<td align="left">currently not used</td>
</tr>
</tbody>
</table>
</div>
<div id="finish_attemptattempt_id-finished_at----" class="section level4">
<h4 class="hasAnchor">
<a href="#finish_attemptattempt_id-finished_at----" class="anchor"></a><code>finish_attempt(attempt_id, finished_at, ...)</code>
</h4>
<p>This function should mark an attempt as “finished” and is invoked when a user finishes an attempt (or the time elapsed). The function should return <code>TRUE</code> if the data is saved successfully and <code>FALSE</code> in case of an error.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Argument</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>attempt_id</code></td>
<td align="left">the attempt identifier (as returned by <code>create_attempt()</code>)</td>
</tr>
<tr class="even">
<td align="left"><code>finished_at</code></td>
<td align="left">the date-time the attempt was finished, including timezone (object of type <code>POSIXct</code>)</td>
</tr>
<tr class="odd">
<td align="left"><code>...</code></td>
<td align="left">currently not used</td>
</tr>
</tbody>
</table>
</div>
<div id="grade_attemptattempt_id-points----" class="section level4">
<h4 class="hasAnchor">
<a href="#grade_attemptattempt_id-points----" class="anchor"></a><code>grade_attempt(attempt_id, points, ...)</code>
</h4>
<p>Grade the given attempt, assigning the given <code>points</code> object to the attempt. The function should return <code>TRUE</code> if the points are saved successfully and <code>FALSE</code> in case of an error.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Argument</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>attempt_id</code></td>
<td align="left">the attempt identifier (as returned by <code>create_attempt()</code>)</td>
</tr>
<tr class="even">
<td align="left"><code>points</code></td>
<td align="left">an R list object which holds all grading information for the attempt</td>
</tr>
<tr class="odd">
<td align="left"><code>...</code></td>
<td align="left">currently not used</td>
</tr>
</tbody>
</table>
</div>
<div id="get_attemptsuser-exam_id-exam_version----" class="section level4">
<h4 class="hasAnchor">
<a href="#get_attemptsuser-exam_id-exam_version----" class="anchor"></a><code>get_attempts(user, exam_id, exam_version, ...)</code>
</h4>
<p>Query all attempts filtered by the given arguments. The argument <code>user</code> may be <code>NULL</code>, in which case the function should return the attempts for <em>all</em> users. The function must return a list of attempt objects (of the form described below), or <code>NULL</code> in case of an error.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Argument</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>user</code></td>
<td align="left">user object as returned by the <a href="config_access.html#authentication-provider">authentication provider</a>
</td>
</tr>
<tr class="even">
<td align="left"><code>exam_id</code></td>
<td align="left">exam identifier (scalar character)</td>
</tr>
<tr class="odd">
<td align="left"><code>exam_version</code></td>
<td align="left">version string associated with the exam (scalar character)</td>
</tr>
<tr class="even">
<td align="left"><code>...</code></td>
<td align="left">currently not used</td>
</tr>
</tbody>
</table>
<p>The function must return a list of attempt objects. An attempt object is a list containing the following information</p>
<table class="table">
<thead><tr class="header">
<th align="left">Element</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>id</code></td>
<td align="left">attempt identifier</td>
</tr>
<tr class="even">
<td align="left"><code>user</code></td>
<td align="left">user object associated with this attempt (as given to <code>create_attempt()</code>)</td>
</tr>
<tr class="odd">
<td align="left"><code>started_at</code></td>
<td align="left">time (as <code>POSIXct</code> object in the <strong>system’s timezone</strong>) the attempt was started</td>
</tr>
<tr class="even">
<td align="left"><code>finished_at</code></td>
<td align="left">time (as <code>POSIXct</code> object in the <strong>system’s timezone</strong>) the attempt was finished (may be <code>NULL</code> if the attempt is not yet finished)</td>
</tr>
<tr class="odd">
<td align="left"><code>points</code></td>
<td align="left">R list object as given to <code>grade_attempt()</code> (may be <code>NULL</code> if the attempt is not yet graded)</td>
</tr>
</tbody>
</table>
</div>
<div id="save_section_dataattempt_id-section-section_data----" class="section level4">
<h4 class="hasAnchor">
<a href="#save_section_dataattempt_id-section-section_data----" class="anchor"></a><code>save_section_data(attempt_id, section, section_data, ...)</code>
</h4>
<p>Save section data for the given attempt. The function should return <code>TRUE</code> if the data is saved successfully and <code>FALSE</code> in case of an error.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Argument</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>attempt_id</code></td>
<td align="left">the attempt identifier (as returned by <code>create_attempt()</code>)</td>
</tr>
<tr class="even">
<td align="left"><code>section</code></td>
<td align="left">section identifier</td>
</tr>
<tr class="odd">
<td align="left"><code>section_data</code></td>
<td align="left">an R list object with section-specific data</td>
</tr>
<tr class="even">
<td align="left"><code>...</code></td>
<td align="left">currently not used</td>
</tr>
</tbody>
</table>
</div>
<div id="get_section_dataattempt_id-section----" class="section level4">
<h4 class="hasAnchor">
<a href="#get_section_dataattempt_id-section----" class="anchor"></a><code>get_section_data(attempt_id, section, ...)</code>
</h4>
<p>Query the <em>most recently saved</em> section data for the given attempt. If <code>section</code> is <code>NULL</code>, the function should not filter by section, but return the latest data for all sections. The function must return a list of section data objects (of the form described below), or <code>NULL</code> in case of an error.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Argument</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>attempt_id</code></td>
<td align="left">the attempt identifier (as returned by <code>create_attempt()</code>)</td>
</tr>
<tr class="even">
<td align="left"><code>section</code></td>
<td align="left">section identifier</td>
</tr>
<tr class="odd">
<td align="left"><code>...</code></td>
<td align="left">currently not used</td>
</tr>
</tbody>
</table>
<p>The function must return a list of section data objects. A section data object is a list containing the following information.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Element</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>section</code></td>
<td align="left">section identifier</td>
</tr>
<tr class="even">
<td align="left"><code>timestamp</code></td>
<td align="left">time (as <code>POSIXct</code> object in the <strong>system’s timezone</strong>) when the data was saved</td>
</tr>
<tr class="odd">
<td align="left"><code>section_data</code></td>
<td align="left">an R list object with section-specific data, exactly as given to <code>save_section_data()</code>
</td>
</tr>
</tbody>
</table>
</div>
<div id="get_last_sectionattempt_id----" class="section level4">
<h4 class="hasAnchor">
<a href="#get_last_sectionattempt_id----" class="anchor"></a><code>get_last_section(attempt_id, ...)</code>
</h4>
<p>Get the identifier of the section for which the most recent data is available (i.e., the section the attempt was showing last). The function should return a character string with the section identifier of the section for which data was saved most recently. In case of an error, or if there is no data available for the given filter, the function should return <code>NULL</code>.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Argument</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>attempt_id</code></td>
<td align="left">the attempt identifier (as returned by <code>create_attempt()</code>)</td>
</tr>
<tr class="even">
<td align="left"><code>...</code></td>
<td align="left">currently not used</td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Kepplinger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
