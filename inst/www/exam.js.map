{"version":3,"sources":["../../srcwww/exam.js"],"names":["window","Exam","kMinLines","kMaxDefaultLines","kModifierKeyNone","kModifierKeyCtrl","kModifierKeyAlt","kModifierKeyShift","kModifierKeyMeta","kKeycodeTab","kKeycodeSpace","exerciseRunButtonEnabled","attachAceEditor","id","code","editor","ace","edit","setHighlightActiveLine","setShowPrintMargin","setShowFoldWidgets","setBehavioursEnabled","renderer","setDisplayIndentGuides","setTheme","$blockScrolling","Infinity","session","setMode","getSelection","clearSelection","setValue","toggleRecomputeOverlay","el","show","$","spinOverlay","children","length","remove","removeClass","prepend","op","offsetParent","get","addClass","exerciseRunning","outputContainer","running","prop","initializeExerciseEditors","each","exercise","exerciseOptions","JSON","parse","detach","text","codeLines","split","lines","Math","max","min","repeat","editorId","input_id","pointsLabel","points","label_class","append","panel_class","button_class","button","title","status_messages","notrun","find","hide","runCodeButton","triggerClick","click","setFontSize","parseFloat","css","commands","addCommand","name","bindKey","win","mac","exec","updateAceHeight","setOptions","minLines","maxLines","getSession","on","focus","data","options","initializeEditorBindings","inputBindings","Shiny","InputBinding","extend","scope","getId","subscribe","callback","unsubscribe","off","getValue","label","output_id","timestamp","Date","getTime","value","register","outputBindings","OutputBinding","renderValue","result","html","status","status_class","renderError","error","message","clearError","autocompleteTimerId","aceAutocompleteCallback","modifierCombination","event","ctrlKey","altKey","metaKey","shiftKey","customRCompleter","insertMatch","ranges","selection","getAllRanges","filterLength","completer","completions","filterText","i","start","column","execCommand","caption","is_function","navigateLeft","addCustomMessageHandler","suggestions","map","item","score","meta","filter","x","isPopupOpen","popup","isOpen","getCompletions","position","_","getTextRange","row","end","priority","setInputValue","exerciseLabel","initializeExerciseAutocomplete","autocomplete","startAutocomplete","onChangeCallback","clearTimeout","action","pos","getCursorPosition","line","getLine","test","delayMs","setTimeout","completers","push","enableBasicAutocompletion","enableLiveAutocompletion","keyBinding","addKeyboardHandler","handleKeyboard","autocompleteKeyboardHandler","hash","keyString","keyCode","modifierCombo","activated","command","initializeAutocomplete","document","ready"],"mappings":"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","sourcesContent":["/*\n * Some parts of this file are dervied from the learnr project, which is licensed under the Apache 2.0 license.\n * Original work Copyright 2019 RStudio\n * Modified work Copyright 2020 David Kepplinger\n */\nwindow.Exam = (function () {\n  'use strict'\n\n  const kMinLines = 5\n  const kMaxDefaultLines = 20\n  const kModifierKeyNone = 0\n  const kModifierKeyCtrl = 1\n  const kModifierKeyAlt = 2\n  const kModifierKeyShift = 4\n  const kModifierKeyMeta = 8\n  const kKeycodeTab = 9\n  const kKeycodeSpace = 32\n\n  /* ----- Initializaton of exercises -----  */\n  var exerciseRunButtonEnabled = true\n\n  function attachAceEditor (id, code) {\n    var editor = ace.edit(id)\n    editor.setHighlightActiveLine(false)\n    editor.setShowPrintMargin(false)\n    editor.setShowFoldWidgets(false)\n    editor.setBehavioursEnabled(true)\n    editor.renderer.setDisplayIndentGuides(false)\n    editor.setTheme('ace/theme/textmate')\n    editor.$blockScrolling = Infinity\n    editor.session.setMode('ace/mode/r')\n    editor.session.getSelection().clearSelection()\n    editor.setValue(code, -1)\n    return editor\n  }\n\n  function toggleRecomputeOverlay (el, show) {\n    if (!el) {\n      // Overlay over entire document\n      el = $('body')\n    } else {\n      el = $(el)\n    }\n\n    var spinOverlay = el.children('.examinr-recompute-overlay')\n\n    // If `show` is missing, show the overlay if it's not present at the moment\n    if (typeof show === 'undefined') {\n      show = (spinOverlay.length === 0)\n    }\n\n    if (show === false) {\n      spinOverlay.remove()\n      el.removeClass('examinr-recompute-outer')\n    } else {\n      spinOverlay = $('<div class=\"examinr-recompute-overlay\"><div class=\"examinr-recompute\"></div></div>')\n      el.prepend(spinOverlay)\n      const op = spinOverlay.offsetParent()\n      if (op.length > 0 && op.get(0) !== el.get(0)) {\n        el.addClass('examinr-recompute-outer')\n      }\n      el.show()\n    }\n  }\n\n  function exerciseRunning (outputContainer, running) {\n    if (typeof running === 'undefined') {\n      running = !exerciseRunButtonEnabled\n    }\n\n    toggleRecomputeOverlay(outputContainer, running)\n    exerciseRunButtonEnabled = (running === false)\n    $('.examinr-run-button').prop('disabled', !exerciseRunButtonEnabled)\n  }\n\n  function initializeExerciseEditors () {\n    $('.examinr-exercise').each(function () {\n      const exercise = $(this)\n      const exerciseOptions = JSON.parse(exercise.children('script[type=\"application/json\"]').detach().text() || '{}')\n      var code = ''\n      exercise.children('pre').each(function () {\n        code += $(this).children('code').text() + '\\n'\n      }).remove()\n\n      const codeLines = code.split(/\\r?\\n/).length\n\n      const lines = (exerciseOptions.lines ? Math.max(1, exerciseOptions.lines)\n        : Math.min(Math.max(kMinLines, codeLines), kMaxDefaultLines))\n\n      if (codeLines < lines) {\n        code += '\\n'.repeat(lines - codeLines)\n      }\n\n      const editorId = exerciseOptions.input_id + '-editor'\n      const pointsLabel = exerciseOptions.points ? '<span class=\"label ' + (exerciseOptions.label_class || '') + '\">' +\n        exerciseOptions.points + '</span>' : ''\n\n      exercise.append(\n        '<div class=\"panel ' + (exerciseOptions.panel_class || '') + '\">' +\n          '<div class=\"panel-heading\">' +\n            '<button type=\"button\" class=\"btn ' + (exerciseOptions.button_class || '') + ' btn-xs examinr-run-button pull-right\"><span class=\"glyphicon glyphicon-play\"></span>' + (exerciseOptions.button || '') + '</button>' +\n            '<h5 class=\"panel-title\">' + (exerciseOptions.title || '') + pointsLabel + '</h5>' +\n          '</div>' +\n          '<div class=\"panel-body\">' +\n            '<div id=\"' + editorId + '\" class=\"examinr-exercise-editor\"></div>' +\n          '</div>' +\n          '<div class=\"panel-footer\">' +\n            '<div class=\"small alert alert-warning examinr-exercise-status\">' +\n              (exerciseOptions.status_messages.notrun || '') +\n            '</div>' +\n          '</div>' +\n        '</div><div class=\"examinr-exercise-output well\"></div>')\n\n      if (!exerciseOptions.status_messages.notrun) {\n        exercise.find('.examinr-exercise-status').hide()\n      }\n      exercise.find('.examinr-exercise-output').hide()\n\n      const runCodeButton = exercise.find('.examinr-run-button')\n\n      // Proxy a \"run code\" event through the button to also trigger shiny input events.\n      const triggerClick = function () {\n        runCodeButton.click()\n      }\n\n      const editor = attachAceEditor(editorId, code)\n      editor.setFontSize(0.8125 * parseFloat(exercise.find('.panel-body').css('font-size')))\n      editor.commands.addCommand({\n        name: 'run_rcode',\n        bindKey: { win: 'Ctrl+Enter', mac: 'Command+Enter' },\n        exec: triggerClick\n      })\n      editor.commands.addCommand({\n        name: 'run_rcode-shift',\n        bindKey: { win: 'Ctrl+Shift+Enter', mac: 'Command+Shift+Enter' },\n        exec: triggerClick\n      })\n\n      const updateAceHeight = function () {\n        editor.setOptions({\n          minLines: lines,\n          maxLines: lines\n        })\n      }\n      updateAceHeight()\n      editor.getSession().on('change', updateAceHeight)\n\n      runCodeButton.click(function () {\n        editor.focus()\n      })\n\n      exercise.data({\n        editor: editor,\n        options: exerciseOptions\n      })\n    })\n  }\n\n  function initializeEditorBindings () {\n    const inputBindings = new Shiny.InputBinding()\n    $.extend(inputBindings, {\n      find: function (scope) {\n        return $(scope).find('.examinr-exercise')\n      },\n      getId: function (exercise) {\n        return $(exercise).data('options').input_id\n      },\n      subscribe: function (exercise, callback) {\n        exercise = $(exercise)\n        exercise.find('.examinr-run-button').on('click.examinrExerciseInputBinding', function () {\n          if (exerciseRunButtonEnabled) {\n            exercise.data('sendData', true)\n            exerciseRunning(exercise.find('.examinr-exercise-output'), true)\n            callback(true)\n          }\n        })\n      },\n      unsubscribe: function (exercise) {\n        $(exercise).find('.examinr-run-button').off('.examinrExerciseInputBinding')\n      },\n      getValue: function (exercise) {\n        exercise = $(exercise)\n        if (exercise.data('sendData') !== true) {\n          return null\n        }\n        exercise.data('sendData', false)\n        return {\n          label: exercise.data('options').label,\n          output_id: exercise.data('options').output_id,\n          code: exercise.data('editor').getSession().getValue(),\n          timestamp: new Date().getTime()\n        }\n      },\n      setValue: function (exercise, value) {\n        $(exercise).data('editor').getSession().setValue(value)\n      }\n    })\n    Shiny.inputBindings.register(inputBindings, 'examinr.exerciseInputBinding')\n\n    const outputBindings = new Shiny.OutputBinding()\n    $.extend(outputBindings, {\n      find: function (scope) {\n        return $(scope).find('.examinr-exercise')\n      },\n      getId: function (exercise) {\n        return $(exercise).data('options').output_id\n      },\n      renderValue: function (exercise, data) {\n        exercise = $(exercise)\n        if (data.result) {\n          exercise.find('.examinr-exercise-output').show().html(data.result)\n        } else {\n          exercise.find('.examinr-exercise-output').hide().html('')\n        }\n        if (data.status) {\n          exercise.find('.examinr-exercise-status')\n            .removeClass('alert-success')\n            .removeClass('alert-info')\n            .removeClass('alert-warning')\n            .removeClass('alert-danger')\n            .addClass('alert-' + (data.status_class || 'info'))\n          exercise.find('.examinr-exercise-status').show().html(data.status)\n        } else {\n          exercise.find('.examinr-exercise-status').hide().html('')\n        }\n        exerciseRunning(exercise.find('.examinr-exercise-output'), false)\n      },\n      renderError: function (exercise, error) {\n        exercise = $(exercise)\n        exerciseRunning(exercise.find('.examinr-exercise-output'), false)\n        exercise.find('.examinr-exercise-output').hide()\n        exercise.find('.examinr-exercise-status').show().text(error.message)\n      },\n      clearError: function (exercise) {\n        exercise = $(exercise)\n        exerciseRunning(exercise.find('.examinr-exercise-output'), false)\n        exercise.find('.examinr-exercise-output').hide()\n        exercise.find('.examinr-exercise-status').hide()\n      }\n    })\n    Shiny.outputBindings.register(outputBindings, 'examinr.exerciseOutputBinding')\n  }\n\n  /* ----- Initializaton of editor autocompleter -----  */\n  var autocompleteTimerId\n  var aceAutocompleteCallback = function () {}\n\n  function modifierCombination (event) {\n    return kModifierKeyNone |\n        (event.ctrlKey ? kModifierKeyCtrl : 0) |\n        (event.altKey ? kModifierKeyAlt : 0) |\n        (event.metaKey ? kModifierKeyMeta : 0) |\n        (event.shiftKey ? kModifierKeyShift : 0)\n  }\n\n  const customRCompleter = {\n    insertMatch: function (editor, data) {\n      // remove prefix\n      const ranges = editor.selection.getAllRanges()\n      const filterLength = editor.completer.completions.filterText.length\n      for (var i = 0; i < ranges.length; i++) {\n        ranges[i].start.column -= filterLength\n        editor.session.remove(ranges[i])\n      }\n\n      // insert completion term (add parentheses for functions)\n      editor.execCommand('insertstring', data.caption)\n\n      // move cursor backwards for functions\n      if (data.is_function) {\n        editor.navigateLeft(1)\n      }\n    }\n  }\n\n  // this message handler is called when new autocomplete results are available.\n  Shiny.addCustomMessageHandler('__.examinr.__-autocomplete', function (suggestions) {\n    const completions = suggestions.map(function (item) {\n      // Items are an array of the form [namespace (str), symbol (str), is_function (bool)]\n      if (!item || !item[1]) {\n        return null\n      }\n      return {\n        caption: item[1] + (item[2] ? '()' : ''),\n        value: item[1],\n        score: 0,\n        meta: item[0] ? ('{' + item[0] + '}') : '',\n        is_function: item[2],\n        completer: customRCompleter\n      }\n    }).filter(x => x)\n    aceAutocompleteCallback(null, completions)\n  })\n\n  function isPopupOpen (editor) {\n    return editor.completer && editor.completer.popup && editor.completer.popup.isOpen\n  }\n\n  function getCompletions (editor, session, position, _, callback) {\n    // send autocompletion request with all the code up to cursor position\n    // (done to enable multi-line autocompletions)\n    const code = session.getTextRange({\n      start: { row: 0, column: 0 },\n      end: position\n    })\n\n    // If the popup is not open, force a Shiny input event, otherwise only if the code changed.\n    const priority = isPopupOpen(editor) ? 'value' : 'event'\n\n    // this will be called when the Shiny message is received\n    aceAutocompleteCallback = callback\n    // update the input value for the autocomplete input\n    Shiny.setInputValue('__.examinr.__-autocomplete', {\n      code: code,\n      label: editor.exerciseLabel\n    }, { priority: priority })\n  }\n\n  // Initialize autocomplete for the exercise.\n  // Return false if the exercise does not need autocomplete, true otherwise.\n  function initializeExerciseAutocomplete () {\n    const exercise = $(this)\n    if (exercise.data('options').autocomplete !== true) {\n      return\n    }\n\n    // Initialize the editor for autocomplete\n\n    const editor = exercise.data('editor')\n    const exerciseOptions = exercise.data('options')\n\n    const startAutocomplete = function () {\n      editor.execCommand('startAutocomplete')\n    }\n\n    const onChangeCallback = function (data) {\n      // use only a single autocompleter at a time!\n      clearTimeout(autocompleteTimerId)\n\n      data = data || {}\n      if (data.action !== 'insert' || !data.lines || !data.lines.length || data.lines.length > 1) {\n        return\n      }\n      // NOTE: Ace has already updated the document line at this point\n      // so we can just look at the state of that line\n      const pos = editor.getCursorPosition()\n      const line = editor.session.getLine(pos.row)\n\n      // NOTE: we allow new autocompletion sessions following a\n      // ':' insertion just to enable cases where the user is\n      // typing e.g. 'stats::rnorm()' while the popup is visible\n      if (isPopupOpen(editor) && !/::$/.test(line)) {\n        return\n      }\n\n      // figure out appropriate delay -- want to autocomplete\n      // immediately after a '$' or '@' insertion, but need to\n      // execute on timeout to allow Ace to finish processing\n      // events (if any)\n      const delayMs = /[$@]$|::$/.test(line) ? 10 : 300\n      autocompleteTimerId = setTimeout(startAutocomplete, delayMs)\n    }\n\n    editor.on('change', onChangeCallback)\n    editor.on('destroy', function () {\n      editor.off(onChangeCallback)\n    })\n\n    editor.exerciseLabel = exerciseOptions.label\n\n    editor.completers = editor.completers || []\n    editor.completers.push({ getCompletions: getCompletions })\n    editor.setOptions({\n      enableBasicAutocompletion: true,\n      enableLiveAutocompletion: false\n    })\n    editor.keyBinding.addKeyboardHandler({ handleKeyboard: autocompleteKeyboardHandler })\n  }\n\n  function autocompleteKeyboardHandler (data, hash, keyString, keyCode, event) {\n    if (hash !== -1 && data.editor) {\n      const modifierCombo = modifierCombination(event)\n      if ((keyCode === kKeycodeSpace && modifierCombo === kModifierKeyCtrl) ||\n          (keyCode === kKeycodeTab && modifierCombo === kModifierKeyNone &&\n            (!data.editor.completer || !data.editor.completer.activated))) {\n        // cancel any pending autocomplete\n        clearTimeout(autocompleteTimerId)\n        if (isPopupOpen(data.editor)) {\n          data.editor.completer.popup.hide()\n          return { command: 'null' }\n        } else {\n          return { command: 'startAutocomplete' }\n        }\n      }\n    }\n  }\n\n  function initializeAutocomplete () {\n    $('.examinr-exercise').each(initializeExerciseAutocomplete)\n  }\n\n  /* ----- Initializaton on document load -----  */\n  $(document).ready(function () {\n    initializeExerciseEditors()\n    initializeEditorBindings()\n    initializeAutocomplete()\n  })\n\n  return {\n    toggleRecomputeOverlay: toggleRecomputeOverlay\n  }\n}())\n"],"file":"exam.js"}