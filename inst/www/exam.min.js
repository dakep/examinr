/*! examinr 0.1.0
 *! Original work (c) 2019 RStudio | License: Apache 2.0
 *! Modified work (c) 2020-2020 David Kepplinger | License: MIT + file LICENSE */

"use strict";window.Exam=function(){var a={};return a.shim=function(){return{toggle:function(a,b){a=a?$(a):$("body");var c=a.children(".examinr-recompute-overlay");if(void 0===b&&(b=0===c.length),!1===b)c.remove(),a.removeClass("examinr-recompute-outer");else{c=$('<div class="examinr-recompute-overlay"><div class="examinr-recompute"></div></div>'),a.prepend(c);var d=c.offsetParent();d.length>0&&d.get(0)!==a.get(0)&&a.addClass("examinr-recompute-outer"),a.show()}}}}(),a.exercises=function(){function b(a,b){var c=ace.edit(a);return c.setHighlightActiveLine(!1),c.setShowPrintMargin(!1),c.setShowFoldWidgets(!1),c.setBehavioursEnabled(!0),c.renderer.setDisplayIndentGuides(!1),c.setTheme("ace/theme/textmate"),c.$blockScrolling=1/0,c.session.setMode("ace/mode/r"),c.session.getSelection().clearSelection(),c.setValue(b,-1),c}function c(b,c){void 0===c&&(c=!h),a.shim.toggle(b,c),h=!1===c,$(".examinr-run-button").prop("disabled",!h)}function d(){$(".examinr-exercise").each(function(){var a=$(this),c=JSON.parse(a.children('script[type="application/json"]').detach().text()||"{}"),d="";a.children("pre").each(function(){d+=$(this).children("code").text()+"\n"}).remove();var e=d.split(/\r?\n/).length,h=c.lines?Math.max(1,c.lines):Math.min(Math.max(f,e),g);e<h&&(d+="\n".repeat(h-e));var i=c.input_id+"-editor",j=c.points?'<span class="label '+(c.label_class||"")+'">'+c.points+"</span>":"";a.append('<div class="panel '+(c.panel_class||"")+'"><div class="panel-heading"><button type="button" class="btn '+(c.button_class||"")+' btn-xs examinr-run-button pull-right"><span class="glyphicon glyphicon-play"></span>'+(c.button||"")+'</button><h5 class="panel-title">'+(c.title||"")+j+'</h5></div><div class="panel-body"><div id="'+i+'" class="examinr-exercise-editor"></div></div><div class="panel-footer"><div class="small alert alert-warning examinr-exercise-status">'+(c.status_messages.notrun||"")+'</div></div></div><div class="examinr-exercise-output well"></div>'),c.status_messages.notrun||a.find(".examinr-exercise-status").hide(),a.find(".examinr-exercise-output").hide();var k=a.find(".examinr-run-button"),l=function(){k.click()},m=b(i,d);m.setFontSize(.8125*parseFloat(a.find(".panel-body").css("font-size"))),m.commands.addCommand({name:"run_rcode",bindKey:{win:"Ctrl+Enter",mac:"Command+Enter"},exec:l}),m.commands.addCommand({name:"run_rcode-shift",bindKey:{win:"Ctrl+Shift+Enter",mac:"Command+Shift+Enter"},exec:l});var n=function(){m.setOptions({minLines:h,maxLines:h})};n(),m.getSession().on("change",n),k.click(function(){m.focus()}),a.data({editor:m,options:c}),a.parents("section").on("shown",function(){m.resize(!0)})})}function e(){var a=new Shiny.InputBinding;$.extend(a,{find:function(a){return $(a).find(".examinr-exercise")},getId:function(a){return $(a).data("options").input_id},subscribe:function(a,b){a=$(a),a.find(".examinr-run-button").on("click.examinrExerciseInputBinding",function(){h&&(a.data("sendData",!0),c(a.find(".examinr-exercise-output"),!0),b(!0))})},unsubscribe:function(a){$(a).find(".examinr-run-button").off(".examinrExerciseInputBinding")},getValue:function(a){return a=$(a),!0!==a.data("sendData")?null:(a.data("sendData",!1),{label:a.data("options").label,output_id:a.data("options").output_id,code:a.data("editor").getSession().getValue(),timestamp:(new Date).getTime()})},setValue:function(a,b){$(a).data("editor").getSession().setValue(b)}}),Shiny.inputBindings.register(a,"examinr.exerciseInputBinding");var b=new Shiny.OutputBinding;$.extend(b,{find:function(a){return $(a).find(".examinr-exercise")},getId:function(a){return $(a).data("options").output_id},renderValue:function(a,b){a=$(a),b.result?a.find(".examinr-exercise-output").show().html(b.result):a.find(".examinr-exercise-output").hide().html(""),b.status?(a.find(".examinr-exercise-status").removeClass("alert-success").removeClass("alert-info").removeClass("alert-warning").removeClass("alert-danger").addClass("alert-"+(b.status_class||"info")),a.find(".examinr-exercise-status").show().html(b.status)):a.find(".examinr-exercise-status").hide().html(""),c(a.find(".examinr-exercise-output"),!1)},renderError:function(a,b){a=$(a),c(a.find(".examinr-exercise-output"),!1),a.find(".examinr-exercise-output").hide(),a.find(".examinr-exercise-status").show().text(b.message)},clearError:function(a){a=$(a),c(a.find(".examinr-exercise-output"),!1),a.find(".examinr-exercise-output").hide(),a.find(".examinr-exercise-status").hide()}}),Shiny.outputBindings.register(b,"examinr.exerciseOutputBinding")}var f=5,g=20,h=!0;return $(document).ready(function(){d(),e()}),{}}(),a.autocomplete=function(){function a(a){return h|(a.ctrlKey?i:0)|(a.altKey?j:0)|(a.metaKey?l:0)|(a.shiftKey?k:0)}function b(a){return a.completer&&a.completer.popup&&a.completer.popup.isOpen}function c(a,c,d,e,f){var g=c.getTextRange({start:{row:0,column:0},end:d}),h=b(a)?"value":"event";o=f,Shiny.setInputValue("__.examinr.__-autocomplete",{code:g,label:a.exerciseLabel},{priority:h})}function d(){var a=$(this);if(!0===a.data("options").autocomplete){var d=a.data("editor"),f=a.data("options"),h=function(){d.execCommand("startAutocomplete")},i=function(a){if(clearTimeout(g),a=a||{},"insert"===a.action&&a.lines&&a.lines.length&&!(a.lines.length>1)){var c=d.getCursorPosition(),e=d.session.getLine(c.row);if(!b(d)||/::$/.test(e)){var f=/[$@]$|::$/.test(e)?10:300;g=setTimeout(h,f)}}};d.on("change",i),d.on("destroy",function(){d.off(i)}),d.exerciseLabel=f.label,d.completers=d.completers||[],d.completers.push({getCompletions:c}),d.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!1}),d.keyBinding.addKeyboardHandler({handleKeyboard:e})}}function e(c,d,e,f,j){if(-1!==d&&c.editor){var k=a(j);if(f===n&&k===i||f===m&&k===h&&(!c.editor.completer||!c.editor.completer.activated))return clearTimeout(g),b(c.editor)?(c.editor.completer.popup.hide(),{command:"null"}):{command:"startAutocomplete"}}}function f(){$(".examinr-exercise").each(d)}var g,h=0,i=1,j=2,k=4,l=8,m=9,n=32,o=function(){},p={insertMatch:function(a,b){for(var c=a.selection.getAllRanges(),d=a.completer.completions.filterText.length,e=0;e<c.length;e++)c[e].start.column-=d,a.session.remove(c[e]);a.execCommand("insertstring",b.caption),b.is_function&&a.navigateLeft(1)}};return Shiny.addCustomMessageHandler("__.examinr.__-autocomplete",function(a){var b=a.map(function(a){return a&&a[1]?{caption:a[1]+(a[2]?"()":""),value:a[1],score:0,meta:a[0]?"{"+a[0]+"}":"",is_function:a[2],completer:p}:null}).filter(function(a){return a});o(null,b)}),$(document).ready(function(){f()}),{}}(),a.sections=function(){function b(){a.shim.toggle($("body"),!1)}function c(){var b=$("#examinr-sections-options");b.length>0&&(f=JSON.parse(b.text()),b.remove()),f.progressive?($("section.level1").hide(),a.shim.toggle($("body"),!0),$(".examinr-section-next").click(function(){a.shim.toggle($("body"),!0)})):($(".examinr-section-next").hide(),$("section.level1").last().find(".examinr-section-next").show())}var d,e=250,f={},g={};Shiny.addCustomMessageHandler("__.examinr.__-sectionChange",function(a){if(a.current){d&&d.hide(),g=a.current,d=$("#"+g.ui_id).parent().show().trigger("shown");var c=d.find(".shiny-bound-output"),f=c.length;if(f>0){var h=window.setTimeout(b,e);c.one("shiny:recalculated",function(){--f,f<=0?b():(window.clearTimeout(h),h=window.setTimeout(b,e))})}else b()}}),$(document).ready(function(){c()})}(),a}();
//# sourceMappingURL=exam.min.js.map