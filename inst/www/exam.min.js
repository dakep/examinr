/*! examinr 0.1.0
 *! Original work (c) 2019 RStudio | License: Apache 2.0
 *! Modified work (c) 2020-2020 David Kepplinger | License: MIT + file LICENSE */

"use strict";window.Exam=function(){function a(a,b){var c=ace.edit(a);return c.setHighlightActiveLine(!1),c.setShowPrintMargin(!1),c.setShowFoldWidgets(!1),c.setBehavioursEnabled(!0),c.renderer.setDisplayIndentGuides(!1),c.setTheme("ace/theme/textmate"),c.$blockScrolling=1/0,c.session.setMode("ace/mode/r"),c.session.getSelection().clearSelection(),c.setValue(b,-1),c}function b(a,b){a=a?$(a):$("body");var c=a.children(".examinr-recompute-overlay");if(void 0===b&&(b=0===c.length),!1===b)c.remove(),a.removeClass("examinr-recompute-outer");else{c=$('<div class="examinr-recompute-overlay"><div class="examinr-recompute"></div></div>'),a.prepend(c);var d=c.offsetParent();d.length>0&&d.get(0)!==a.get(0)&&a.addClass("examinr-recompute-outer"),a.show()}}function c(a,c){void 0===c&&(c=!v),b(a,c),v=!1===c,$(".examinr-run-button").prop("disabled",!v)}function d(){$(".examinr-exercise").each(function(){var b=$(this),c=JSON.parse(b.children('script[type="application/json"]').detach().text()||"{}"),d="";b.children("pre").each(function(){d+=$(this).children("code").text()+"\n"}).remove();var e=d.split(/\r?\n/).length,f=c.lines?Math.max(1,c.lines):Math.min(Math.max(m,e),n);e<f&&(d+="\n".repeat(f-e));var g=c.input_id+"-editor",h=c.points?'<span class="label '+(c.label_class||"")+'">'+c.points+"</span>":"";b.append('<div class="panel '+(c.panel_class||"")+'"><div class="panel-heading"><button type="button" class="btn '+(c.button_class||"")+' btn-xs examinr-run-button pull-right"><span class="glyphicon glyphicon-play"></span>'+(c.button||"")+'</button><h5 class="panel-title">'+(c.title||"")+h+'</h5></div><div class="panel-body"><div id="'+g+'" class="examinr-exercise-editor"></div></div><div class="panel-footer"><div class="small alert alert-warning examinr-exercise-status">'+(c.status_messages.notrun||"")+'</div></div></div><div class="examinr-exercise-output well"></div>'),c.status_messages.notrun||b.find(".examinr-exercise-status").hide(),b.find(".examinr-exercise-output").hide();var i=b.find(".examinr-run-button"),j=function(){i.click()},k=a(g,d);k.setFontSize(.8125*parseFloat(b.find(".panel-body").css("font-size"))),k.commands.addCommand({name:"run_rcode",bindKey:{win:"Ctrl+Enter",mac:"Command+Enter"},exec:j}),k.commands.addCommand({name:"run_rcode-shift",bindKey:{win:"Ctrl+Shift+Enter",mac:"Command+Shift+Enter"},exec:j});var l=function(){k.setOptions({minLines:f,maxLines:f})};l(),k.getSession().on("change",l),i.click(function(){k.focus()}),b.data({editor:k,options:c})})}function e(){var a=new Shiny.InputBinding;$.extend(a,{find:function(a){return $(a).find(".examinr-exercise")},getId:function(a){return $(a).data("options").input_id},subscribe:function(a,b){a=$(a),a.find(".examinr-run-button").on("click.examinrExerciseInputBinding",function(){v&&(a.data("sendData",!0),c(a.find(".examinr-exercise-output"),!0),b(!0))})},unsubscribe:function(a){$(a).find(".examinr-run-button").off(".examinrExerciseInputBinding")},getValue:function(a){return a=$(a),!0!==a.data("sendData")?null:(a.data("sendData",!1),{label:a.data("options").label,output_id:a.data("options").output_id,code:a.data("editor").getSession().getValue(),timestamp:(new Date).getTime()})},setValue:function(a,b){$(a).data("editor").getSession().setValue(b)}}),Shiny.inputBindings.register(a,"examinr.exerciseInputBinding");var b=new Shiny.OutputBinding;$.extend(b,{find:function(a){return $(a).find(".examinr-exercise")},getId:function(a){return $(a).data("options").output_id},renderValue:function(a,b){a=$(a),b.result?a.find(".examinr-exercise-output").show().html(b.result):a.find(".examinr-exercise-output").hide().html(""),b.status?(a.find(".examinr-exercise-status").removeClass("alert-success").removeClass("alert-info").removeClass("alert-warning").removeClass("alert-danger").addClass("alert-"+(b.status_class||"info")),a.find(".examinr-exercise-status").show().html(b.status)):a.find(".examinr-exercise-status").hide().html(""),c(a.find(".examinr-exercise-output"),!1)},renderError:function(a,b){a=$(a),c(a.find(".examinr-exercise-output"),!1),a.find(".examinr-exercise-output").hide(),a.find(".examinr-exercise-status").show().text(b.message)},clearError:function(a){a=$(a),c(a.find(".examinr-exercise-output"),!1),a.find(".examinr-exercise-output").hide(),a.find(".examinr-exercise-status").hide()}}),Shiny.outputBindings.register(b,"examinr.exerciseOutputBinding")}function f(a){return o|(a.ctrlKey?p:0)|(a.altKey?q:0)|(a.metaKey?s:0)|(a.shiftKey?r:0)}function g(a){return a.completer&&a.completer.popup&&a.completer.popup.isOpen}function h(a,b,c,d,e){var f=b.getTextRange({start:{row:0,column:0},end:c}),h=g(a)?"value":"event";w=e,Shiny.setInputValue("__.examinr.__-autocomplete",{code:f,label:a.exerciseLabel},{priority:h})}function i(){var a=$(this);if(!0===a.data("options").autocomplete){var b=a.data("editor"),c=a.data("options"),d=function(){b.execCommand("startAutocomplete")},e=function(a){if(clearTimeout(l),a=a||{},"insert"===a.action&&a.lines&&a.lines.length&&!(a.lines.length>1)){var c=b.getCursorPosition(),e=b.session.getLine(c.row);if(!g(b)||/::$/.test(e)){var f=/[$@]$|::$/.test(e)?10:300;l=setTimeout(d,f)}}};b.on("change",e),b.on("destroy",function(){b.off(e)}),b.exerciseLabel=c.label,b.completers=b.completers||[],b.completers.push({getCompletions:h}),b.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!1}),b.keyBinding.addKeyboardHandler({handleKeyboard:j})}}function j(a,b,c,d,e){if(-1!==b&&a.editor){var h=f(e);if(d===u&&h===p||d===t&&h===o&&(!a.editor.completer||!a.editor.completer.activated))return clearTimeout(l),g(a.editor)?(a.editor.completer.popup.hide(),{command:"null"}):{command:"startAutocomplete"}}}function k(){$(".examinr-exercise").each(i)}var l,m=5,n=20,o=0,p=1,q=2,r=4,s=8,t=9,u=32,v=!0,w=function(){},x={insertMatch:function(a,b){for(var c=a.selection.getAllRanges(),d=a.completer.completions.filterText.length,e=0;e<c.length;e++)c[e].start.column-=d,a.session.remove(c[e]);a.execCommand("insertstring",b.caption),b.is_function&&a.navigateLeft(1)}};return Shiny.addCustomMessageHandler("__.examinr.__-autocomplete",function(a){var b=a.map(function(a){return a&&a[1]?{caption:a[1]+(a[2]?"()":""),value:a[1],score:0,meta:a[0]?"{"+a[0]+"}":"",is_function:a[2],completer:x}:null}).filter(function(a){return a});w(null,b)}),$(document).ready(function(){d(),e(),k()}),{toggleRecomputeOverlay:b}}();
//# sourceMappingURL=exam.min.js.map